# ETF基金实时行情功能使用指南

## 快速开始

### 1. 启动服务

**后端服务**:
```bash
cd /Users/yunjinqi/Documents/TradingAgents-CN
python main.py
# 服务将在 http://localhost:8000 启动
```

**前端服务**:
```bash
cd /Users/yunjinqi/Documents/TradingAgents-CN/frontend
npm run dev
# 服务将在 http://localhost:5173 启动
```

### 2. 访问页面
1. 浏览器打开: http://localhost:5173
2. 登录系统
3. 导航路径: **基金投研** → **数据集合** → **ETF基金实时行情-东财**

## 功能说明

### 数据概览
页面顶部显示：
- 📊 总记录数
- 📈 上涨家数（红色卡片）
- 📉 下跌家数（蓝色卡片）
- ➖ 平盘家数（灰绿色卡片）

### 市场概况图表
- **涨跌分布饼图**: 直观展示上涨、下跌、平盘的比例
- **成交额TOP10柱状图**: 显示成交最活跃的ETF

### 数据列表
- ✅ 分页展示（每页20/50/100/200条可选）
- ✅ 字段排序（点击表头）
  - 按涨跌幅排序查看涨幅榜/跌幅榜
  - 按成交额排序查看最活跃ETF
- ✅ 数据筛选（搜索框）
- ✅ 字段说明（鼠标悬停查看）

### 更新数据
点击"更新数据"按钮，支持三种方式：

#### 方式1: API更新（推荐）
从东方财富网自动获取最新数据：
1. 在对话框中直接点击底部的"开始更新"按钮
2. 系统自动调用AKShare的`fund_etf_spot_em()`接口
3. 实时显示进度条和状态信息
4. 完成后自动刷新页面数据

**特点**：
- ✅ 数据最新（实时行情）
- ✅ 数据全面（1000+只ETF）
- ✅ 自动去重和更新
- ✅ 无需准备数据文件

#### 方式2: 文件导入
从本地CSV或Excel文件导入数据：

**步骤**：
1. 准备数据文件（CSV或Excel格式）
2. 在对话框的"文件导入"区域，拖拽文件或点击选择
3. 点击"导入文件"按钮
4. 等待导入完成

**文件格式要求**：
- 支持格式：`.csv`, `.xlsx`, `.xls`
- 必需字段：
  - `代码`（ETF代码）
  - `名称`（ETF名称）
  - `最新价`
  - `涨跌幅`
  - `成交额`
- 可选字段：
  - `IOPV实时估值`
  - `基金折价率`
  - `主力净流入-净额`
  - `数据日期`
  - 等37个字段

**示例CSV内容**：
```csv
代码,名称,最新价,涨跌幅,成交额,开盘价,最高价,最低价,昨收,数据日期
520890,港股通红利低波ETF,1.234,0.98,15234567,1.220,1.240,1.210,1.222,2024-12-26
159331,红利港股ETF,2.345,-1.23,25234567,2.360,2.380,2.330,2.374,2024-12-26
```

**优点**：
- ✅ 适合批量导入历史数据
- ✅ 可以从其他系统导出后导入
- ✅ 支持自定义数据

#### 方式3: 远程同步
从远程MongoDB数据库同步数据：

**步骤**：
1. 在对话框的"远程同步"区域，填写连接信息：
   - **远程主机**：IP地址或MongoDB URI
     - 简单格式：`192.168.1.10`
     - 完整URI：`mongodb://user:pwd@host:27017/db`
   - **数据库类型**：默认MongoDB（不可修改）
   - **批次大小**：1000/2000/5000/10000（建议2000）
   - **远程集合名称**：默认为`fund_etf_spot_em`
   - **用户名**：MongoDB用户名（可选）
   - **认证库**：通常为`admin`或`tradingagents`
   - **密码**：MongoDB密码（可选）

2. 点击"远程同步"按钮
3. 等待同步完成，查看同步统计

**优点**：
- ✅ 快速同步大量数据
- ✅ 适合多环境数据迁移
- ✅ 支持增量更新

### 其他功能
- **刷新**: 重新加载当前页面数据
- **清空数据**: 删除所有数据（需确认）

## 数据字段说明

### 基本信息
| 字段名 | 类型 | 说明 |
|--------|------|------|
| 代码 | 字符串 | ETF代码 |
| 名称 | 字符串 | ETF名称 |
| 最新价 | 浮点数 | 最新价格 |
| IOPV实时估值 | 浮点数 | 实时净值估值 |
| 基金折价率 | 浮点数 | 折价率（%），负数表示折价，正数表示溢价 |

### 涨跌信息
| 字段名 | 类型 | 说明 |
|--------|------|------|
| 涨跌额 | 浮点数 | 价格变化金额 |
| 涨跌幅 | 浮点数 | 涨跌百分比（%） |

### 成交信息
| 字段名 | 类型 | 说明 |
|--------|------|------|
| 成交量 | 浮点数 | 成交量 |
| 成交额 | 浮点数 | 成交金额 |
| 换手率 | 浮点数 | 换手率 |
| 量比 | 浮点数 | 量比指标 |

### 价格信息
| 字段名 | 类型 | 说明 |
|--------|------|------|
| 开盘价 | 浮点数 | 今日开盘价 |
| 最高价 | 浮点数 | 今日最高价 |
| 最低价 | 浮点数 | 今日最低价 |
| 昨收 | 浮点数 | 昨日收盘价 |

### 资金流向（重要）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| 主力净流入-净额 | 浮点数 | 主力资金净流入金额 |
| 主力净流入-净占比 | 浮点数 | 主力资金净流入占比（%） |
| 超大单净流入-净额 | 浮点数 | 超大单资金净流入 |
| 超大单净流入-净占比 | 浮点数 | 超大单资金占比（%） |
| 大单净流入-净额 | 浮点数 | 大单资金净流入 |
| 大单净流入-净占比 | 浮点数 | 大单资金占比（%） |
| 中单净流入-净额 | 浮点数 | 中单资金净流入 |
| 中单净流入-净占比 | 浮点数 | 中单资金占比（%） |
| 小单净流入-净额 | 浮点数 | 小单资金净流入 |
| 小单净流入-净占比 | 浮点数 | 小单资金占比（%） |

### 其他
| 字段名 | 类型 | 说明 |
|--------|------|------|
| 委比 | 浮点数 | 委比指标 |
| 外盘 | 浮点数 | 外盘数量 |
| 内盘 | 浮点数 | 内盘数量 |
| 现手 | 浮点数 | 当前成交手数 |
| 买一 | 浮点数 | 买一价格 |
| 卖一 | 浮点数 | 卖一价格 |
| 最新份额 | 浮点数 | 最新基金份额 |
| 流通市值 | 整数 | 流通市值 |
| 总市值 | 整数 | 总市值 |
| 数据日期 | 字符串 | 数据日期 |
| 更新时间 | 字符串 | 更新时间 |

## 使用技巧

### 1. 查看涨幅榜
1. 点击"涨跌幅"表头，按降序排序
2. 查看排在前面的ETF（涨幅最大）

### 2. 查看跌幅榜
1. 点击"涨跌幅"表头，按升序排序
2. 查看排在前面的ETF（跌幅最大）

### 3. 查看成交活跃度
1. 点击"成交额"表头，按降序排序
2. 或查看"成交额TOP10"图表

### 4. 分析资金流向
1. 关注"主力净流入"字段
2. 正值表示资金流入，负值表示资金流出
3. 结合净占比分析资金力度

### 5. 识别套利机会
1. 关注"基金折价率"字段
2. 负值较大表示折价（可能低估）
3. 正值较大表示溢价（可能高估）

## API接口

### 获取数据
```bash
curl -X GET "http://localhost:8000/api/funds/collections/fund_etf_spot_em?page=1&page_size=50&sort_by=涨跌幅&sort_dir=desc" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 获取统计
```bash
curl -X GET "http://localhost:8000/api/funds/collections/fund_etf_spot_em/stats" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 刷新数据
```bash
curl -X POST "http://localhost:8000/api/funds/collections/fund_etf_spot_em/refresh" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{}'
```

### 清空数据
```bash
curl -X DELETE "http://localhost:8000/api/funds/collections/fund_etf_spot_em/clear" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## 常见问题

### Q1: 数据多久更新一次？
**A**: 
- 手动更新：点击"更新数据"按钮
- 建议：交易时间每5-15分钟更新一次
- 可配置定时任务自动更新（需要额外开发）

### Q2: 为什么有些ETF显示折价，有些显示溢价？
**A**: 
- 折价：ETF市价 < IOPV净值，可能被低估
- 溢价：ETF市价 > IOPV净值，可能被高估
- 套利机会：折溢价率较大时存在套利空间

### Q3: 主力资金流入/流出如何判断？
**A**: 
- 主力净流入为正：主力资金流入，看多信号
- 主力净流入为负：主力资金流出，看空信号
- 结合净占比：占比越大，信号越强

### Q4: 如何导出数据？
**A**: 可以使用MongoDB工具导出：
```bash
mongoexport --db=tradingagents --collection=fund_etf_spot_em --out=etf_data.json
```

### Q5: 数据不显示？
**A**: 
1. 检查是否已执行"更新数据"
2. 刷新页面
3. 检查MongoDB连接是否正常
4. 查看后端日志了解具体错误

## 技术支持

- 📖 详细文档: `tests/funds/06_ETF基金实时行情_实现总结.md`
- 🧪 测试用例: `tests/funds/test_fund_etf_spot.py`
- 📊 需求文档: `tests/funds/06_ETF基金实时行情.md`

## 注意事项

1. **交易时间**: ETF实时行情数据在交易时间最有价值（周一至周五 9:30-15:00）
2. **数据时效**: 建议交易时间频繁更新，非交易时间不需要更新
3. **折溢价**: 折溢价率仅供参考，套利需考虑交易成本
4. **资金流向**: 资金流向数据有一定延迟，仅供参考
5. **数据量**: 约1000+只ETF，加载较快

## 投资建议

⚠️ **风险提示**：
- 本功能仅提供数据展示和分析工具
- 不构成任何投资建议
- 投资有风险，入市需谨慎
- 请根据自身风险承受能力做出投资决策
