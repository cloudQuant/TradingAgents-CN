### 更新债券基础信息

参考债券基础信息查询页面的样式和API接口，更新债券基础信息页面。

更新这个页面：http://43.159.39.216:3000/bonds/collections/bond_basic_info



### 新增需求：

0. 优化现有的债券基础信息页面，参考债券基础信息查询页面的样式和API接口，更新债券基础信息页面。

1. 在更新数据页面，批量更新是从bond_info_cm表中查询债券简称，然后从bond_info_detail_cm中获取债券的详细信息，更新bond_info_detail_cm到这个集合中；如果是其他命名，也可以考虑。采用多个线程批量更新，默认是3个线程，每获取1000条数据，保存到集合一次。

2. 采用增量更新的方式，从bond_info_cm集合中查询债券简称，然后从bond_info_detail_cm集合中获取债券的简称，获取债券基础信息这个里面没有的债券简称，然后更新这些债券的基础信息到集合中。

3. 注意，新增的数据处理需求是在更新数据按钮和弹出的对话框中实现的，参考债券基础信息查询中的更新数据按钮和弹出的对话框。

### 测试驱动
0. 可以考虑playwright或者selenium实现测试用例的自动化测试。
1. 根据上面的新增需求，写测试用例，覆盖上面的新增需求。
2. 根据测试用例，实现代码。

### 验收标准

1. 手动验收：功能没有明显异常
2. 自动验收：测试用例需要能够通过，最好能够使用网页自动化工具，实现测试成功。

### 获取数据接口：
债券基础信息
接口: bond_info_detail_cm

目标地址: https://www.chinamoney.com.cn/chinese/zqjc/?bondDefinedCode=egfjh08154

描述: 中国外汇交易中心暨全国银行间同业拆借中心-数据-债券信息-信息查询-债券详情

输入参数

名称	类型	描述
symbol	str	symbol="19万林投资CP001"; 通过 ak.bond_info_cm() 查询 债券简称
输出参数

名称	类型	描述
name	object	-
value	object	-
接口示例

import akshare as ak

bond_info_detail_cm_df = ak.bond_info_detail_cm(symbol="19万林投资CP001")
print(bond_info_detail_cm_df)
数据示例

        name                       value
0        bondFullName  重庆万林投资发展有限公司2019年度第一期短期融资券
1     bondDefinedCode                  695327xh9n
2            bondName                 19万林投资CP001
3            bondCode                   041900126
4            isinCode                         ---
..                ...                         ...
59        chrgngMthds                         ---
60             crdtEv                         ---
61     brchStlmntMthd                         ---
62  rgstrtnCnfrmtnDay                         ---
63             inptTp                           0
[64 rows x 2 columns]

### 提醒：

所做的改动和更新，需要在这个文件下面说明；
测试用例在那个文件也需要说明。

---

## 实现说明

### 改动和更新记录

根据上述需求，已完成以下改动和更新：

#### 1. 前端界面增强 (frontend/src/views/Bonds/Collection.vue)

**位置**: `F:\source_code\TradingAgents-CN\frontend\src\views\Bonds\Collection.vue`

**改动内容**:
- 在`bond_basic_info`集合的更新数据对话框中新增债券基础信息更新功能区域
- 添加批量更新和增量更新的参数配置（批次大小、并发线程数、保存间隔）
- 新增批量更新、增量更新、查询统计三个操作按钮
- 添加统计信息显示区域，展示基础信息总数、详细信息总数、覆盖率、缺失详情数
- 添加进度显示组件，实时显示更新进度和详细信息
- 参考债券基础信息查询页面的样式实现，保持UI一致性

#### 2. 前端API接口扩展 (frontend/src/api/bonds.ts)

**位置**: `F:\source_code\TradingAgents-CN\frontend\src\api\bonds.ts`

**新增接口**:
- `startBondBasicBatchUpdate()` - 启动债券基础信息批量更新
- `startBondBasicIncrementalUpdate()` - 启动债券基础信息增量更新
- `getBondBasicUpdateStatistics()` - 获取债券基础信息更新统计

#### 3. 后端API端点 (app/routers/bonds.py)

**位置**: `F:\source_code\TradingAgents-CN\app\routers\bonds.py`

**新增端点**:
- `POST /api/bonds/basic-info/batch-update` - 批量更新API
- `POST /api/bonds/basic-info/incremental-update` - 增量更新API
- `GET /api/bonds/basic-info/update-statistics` - 统计查询API

#### 4. 后端业务逻辑服务 (app/services/bond_basic_info_service.py)

**位置**: `F:\source_code\TradingAgents-CN\app\services\bond_basic_info_service.py`

**核心功能**:
- `batch_update_from_bond_info_cm()` - 批量更新功能，从bond_info_cm查询债券简称，使用akshare.bond_info_detail_cm获取详细信息
- `incremental_update_missing_info()` - 增量更新功能，对比bond_info_cm和bond_info_detail_cm的差异，只更新缺失部分
- `get_update_statistics()` - 统计信息查询，返回覆盖率和缺失数量等指标

**技术特性**:
- 支持多线程并发处理（默认3个线程，可配置1-10个）
- 批量处理机制，每批1000条数据（可配置100-5000）
- API限流保护，避免过度调用akshare接口
- 完善的错误处理和日志记录
- 异步处理，不阻塞用户界面

### 测试用例文件

#### 1. 单元测试
**文件**: `F:\source_code\TradingAgents-CN\tests\bonds\test_bond_basic_info_enhancement.py`

**测试覆盖**:
- 批量更新成功场景测试
- 批量更新无数据场景测试
- 增量更新成功场景测试
- 增量更新无缺失代码场景测试
- 统计信息获取测试
- akshare接口错误处理测试
- API端点认证和响应测试

#### 2. 自动化测试
**文件**: `F:\source_code\TradingAgents-CN\tests\bonds\test_bond_basic_info_automation.py`

**测试覆盖**:
- 登录和导航到bond_basic_info页面
- 更新数据对话框打开测试
- 批量更新UI交互测试
- 增量更新UI交互测试
- 统计查询功能测试
- 完整工作流程测试
- 性能测试（对话框加载耗时）

### 运行指南

#### 前端开发服务器
```bash
cd F:\source_code\TradingAgents-CN\frontend
npm run dev
```

#### 后端服务器
```bash
cd F:\source_code\TradingAgents-CN
python -m app
```

#### 运行测试
```bash
# 单元测试
cd F:\source_code\TradingAgents-CN
python -m pytest tests/bonds/test_bond_basic_info_enhancement.py -v

# 自动化测试（需要先安装playwright）
pip install playwright
playwright install
python -m pytest tests/bonds/test_bond_basic_info_automation.py -v

# 或直接运行
cd tests/bonds
python test_bond_basic_info_automation.py run
```

### 使用说明

1. **访问债券基础信息页面**:
   - 登录系统后，导航到：债券数据 → 债券集合
   - 选择"债券基础信息"（bond_basic_info）

2. **批量更新操作**:
   - 点击"更新数据"按钮
   - 在对话框中找到"债券基础信息更新"区域
   - 配置批次大小、并发线程数、保存间隔参数
   - 点击"批量更新"按钮，确认后开始执行

3. **增量更新操作**:
   - 在同一对话框中点击"增量更新"按钮
   - 系统自动检测缺失的债券信息并更新

4. **查看统计信息**:
   - 点击"查询统计"按钮
   - 查看基础信息总数、详细信息总数、覆盖率等指标

### 验收标准达成情况

#### 手动验收
- **功能正常**: 批量更新和增量更新功能无明显异常
- **界面友好**: UI参考债券基础信息查询页面样式，保持一致性
- **集成良好**: 功能集成在现有的更新数据对话框中
- **参数可配置**: 支持批次大小、线程数等参数调整

#### 自动验收  
- **单元测试**: 全面的pytest测试用例覆盖核心功能
- **自动化测试**: Playwright网页自动化测试验证UI交互
- **API测试**: 后端API端点功能验证
- **错误处理**: 异常情况和边界条件测试

### 技术亮点

1. **参考设计**: 严格按照债券基础信息查询页面的样式和API接口模式实现
2. **集成方式**: 功能完全集成在现有的更新数据按钮和对话框中，用户体验一致
3. **数据源**: 按需求使用akshare.bond_info_detail_cm接口获取详细信息
4. **多线程**: 支持3个默认线程的并发处理，提升更新效率
5. **增量更新**: 智能对比数据差异，避免重复处理
6. **实时统计**: 提供覆盖率、缺失数量等关键指标
7. **测试驱动**: 完整的单元测试和自动化测试覆盖

该实现完全符合需求文档要求，成功在现有的债券基础信息页面中集成了批量更新和增量更新功能。