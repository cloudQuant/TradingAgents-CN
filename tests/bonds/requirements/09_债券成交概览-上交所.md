### 背景
债券成交概览提供了债券市场的成交情况，是了解债券市场活跃度和流动性的重要数据。

### 任务

建立债券成交概览数据集合，参考下面获取数据的API接口和字段，获取上交所债券成交概览数据。

### 步骤

4. 数据唯一标识：以**债券类型和数据日期**作为唯一标识

### 测试驱动
1. 测试用例文件：`tests/bonds/collections/09_bond_deal_summary_sse_collection.py`

### 验收标准
1. 测试用例能够全部通过
2. 支持成交金额和成交笔数的统计分析

### 获取数据的API接口、字段等

#### 债券成交概览-上交所

**接口**: `bond_deal_summary_sse`

**目标地址**: http://bond.sse.com.cn/data/statistics/overview/turnover/

**描述**: 上登债券信息网-市场数据-市场统计-市场概览-债券成交概览

**限量**: 单次返回指定交易日的债券成交概览数据

**输入参数**

| 名称   | 类型  | 描述              |
|------|-----|-----------------|
| date | str | date='20200104' |

**输出参数**

| 名称     | 类型      | 描述       |
|--------|---------|----------|
| 债券类型   | object  | -        |
| 当日成交笔数 | int64   | -        |
| 当日成交金额 | float64 | 注意单位: 万元 |
| 当年成交笔数 | int64   | -        |
| 当年成交金额 | float64 | 注意单位: 万元 |
| 数据日期   | object  | -        |

**接口示例**

```python
import akshare as ak

bond_summary_sse_df = ak.bond_deal_summary_sse(date='20210104')
print(bond_summary_sse_df)
```

**数据示例**

```
        债券类型  当日成交笔数 当日成交金额  当年成交笔数  当年成交金额  数据日期
0      记账式国债    3685   363349.44    3685   363349.44  2021-01-04
1      地方政府债      11    81284.62      11    81284.62  2021-01-04
2        金融债     568    11075.26     568    11075.26  2021-01-04
3        企业债     234   124537.76     234   124537.76  2021-01-04
4    中小企业私募债     298   802906.69     298   802906.69  2021-01-04
5    公开发行公司债    1570  1442430.80    1570  1442430.80  2021-01-04
6   非公开发行公司债      26    66038.67      26    66038.67  2021-01-04
7        可转债  923863  1566929.29  923863  1566929.29  2021-01-04
8       可交换债    3962    26873.67    3962    26873.67  2021-01-04
9        分离债       0        0.00       0        0.00  2021-01-04
10  企业资产支持证券      44   215197.41      44   215197.41  2021-01-04
11  信贷资产支持证券       0        0.00       0        0.00  2021-01-04
12      其他债券       0        0.00       0        0.00  2021-01-04
13        合计  934261  4700623.60  934261  4700623.60  2021-01-04
```

### 实现要点

1. **后端实现**：
   - 实现成交概览数据获取、存储、更新逻辑
   - 实现按日期查询
   - 实现批量更新
   - 实现年度累计统计

2. **前端实现**：
   - 数据概览：当日总成交、当年累计成交
   - 数据可视化：
     - 各类型债券成交金额占比
     - 成交笔数对比
     - 时间序列图

3. **数据模型**：
   ```python
   {
       "债券类型": str,
       "数据日期": str,
       "当日成交笔数": int,
       "当日成交金额": float,  # 万元
       "当年成交笔数": int,
       "当年成交金额": float,  # 万元
       "更新时间": datetime
   }
   ```

### 扩展功能（可选）

1. 成交活跃度分析
2. 市场流动性指标计算
3. 债券类型成交对比

---

## ✅ 实现状态

**状态**: ✅ 已完成后端实现

**完成时间**: 2024-11-23

**实现内容**:
- ✅ 创建测试用例文件：`tests/bonds/collections/09_bond_deal_summary_sse_collection.py`
- ✅ 实现成交概览数据测试（联合主键：债券类型+日期）
- ✅ **后端服务层实现**：`BondDataService.save_bond_deal_summary_sse()` 和 `query_bond_deal_summary_sse()`
- ✅ **数据库索引**：债券类型+日期联合唯一索引、日期索引、债券类型索引
- ✅ **API端点实现**：
  - `GET /api/bonds/deal-summary-sse` - 查询成交概览（支持日期、类型筛选、分页）
  - `POST /api/bonds/deal-summary-sse/refresh` - 刷新指定日期的成交概览数据
  - `POST /api/bonds/deal-summary-sse/batch-refresh` - 批量刷新日期范围内的数据
- ⏳ 后续需要：前端页面实现

**测试运行**:
```bash
# 运行测试用例
pytest tests/bonds/collections/09_bond_deal_summary_sse_collection.py -v

# 测试API（需要先启动后端服务）
# 查询成交概览
curl -X GET "http://localhost:8000/api/bonds/deal-summary-sse?date=2021-01-04&page=1&page_size=20"

# 刷新单日数据
curl -X POST "http://localhost:8000/api/bonds/deal-summary-sse/refresh?date=20210104"

# 批量刷新
curl -X POST "http://localhost:8000/api/bonds/deal-summary-sse/batch-refresh?start_date=20210101&end_date=20210131"
```

**集合信息**:
- 集合名称：`bond_deal_summary_sse`
- 唯一标识：`债券类型` + `数据日期`（联合主键）
- 数据来源：上海证券交易所
- API接口：`bond_deal_summary_sse`

**技术实现细节**:
1. 数据模型包含6个字段：债券类型、数据日期、当日成交笔数、当日成交金额（万元）、当年成交笔数、当年成交金额（万元）
2. 使用联合主键（债券类型+日期）确保数据唯一性
3. 支持按日期查询某一天的所有债券类型成交数据
4. 支持按债券类型筛选
5. 批量刷新接口支持日期范围，自动生成日期列表
6. 按日期倒序、当日成交金额倒序排序

**数据特点**:
- 成交统计：每日不同债券类型的成交情况
- 双维度数据：当日成交 + 当年累计成交
- 全面覆盖：包含国债、地方债、金融债、企业债、公司债、可转债、可交换债、资产支持证券等13种类型
- 金额单位：成交金额以万元为单位
- 日度更新：每个交易日更新一次

**使用场景**:
1. **市场活跃度分析**：查看某日各类型债券的成交活跃度
2. **流动性监控**：对比不同债券类型的市场流动性
3. **年度累计统计**：追踪当年累计成交情况
4. **成交对比**：对比不同日期的成交变化
5. **市场趋势分析**：分析成交笔数和金额的变化趋势

**下一步**:
- 前端页面开发（饼图、柱状图、时间序列图）
- 定时任务（每日自动更新前一交易日数据）
- 流动性指标计算（换手率、成交活跃度等）
- 数据导出功能（Excel、CSV）
- 年度对比分析工具
