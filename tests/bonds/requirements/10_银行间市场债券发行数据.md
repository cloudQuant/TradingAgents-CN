### 背景
银行间市场是中国债券市场的主要组成部分，债券发行数据是了解债券供给情况的重要信息。

### 任务

建立银行间市场债券发行数据集合，参考下面获取数据的API接口和字段，获取债券发行基础数据。

### 步骤

4. 数据唯一标识：以**债券名称和注册通知书文号**作为唯一标识

### 测试驱动
1. 测试用例文件：`tests/bonds/collections/10_bond_debt_nafmii_collection.py`

### 验收标准
1. 测试用例能够全部通过
2. 支持分页加载和检索

### 获取数据的API接口、字段等

#### 银行间市场债券发行数据

**接口**: `bond_debt_nafmii`

**目标地址**: http://zhuce.nafmii.org.cn/fans/publicQuery/manager

**描述**: 中国银行间市场交易商协会-非金融企业债务融资工具注册信息系统

**限量**: 单次获取指定 page 页面数据的 50 条数据

**输入参数**

| 名称   | 类型  | 描述                     |
|------|-----|------------------------|
| page | str | page="1", 需要获取第 page 页 |

**输出参数**

| 名称      | 类型      | 描述      |
|---------|---------|---------|
| 债券名称    | object  | -       |
| 品种      | object  | -       |
| 注册或备案   | object  | -       |
| 金额      | float64 | 注意单位：亿元 |
| 注册通知书文号 | object  | -       |
| 更新日期    | object  | -       |
| 项目状态    | object  | -       |

**接口示例**

```python
import akshare as ak

bond_debt_nafmii_df = ak.bond_debt_nafmii(page="2")
print(bond_debt_nafmii_df)
```

**数据示例**

```
                                          债券名称        品种  ...        更新日期  项目状态
0       绍兴市柯桥区开发经营集团有限公司关于2024年度第一期超短期融资券的注册报告   SCP  ...  2024-03-15    20
1         上海市北高新（集团）有限公司关于2024年度第一期超短期融资券的注册报告   SCP  ...  2024-03-15    40
2           江苏黄海金融控股集团有限公司关于2024年度第一期中期票据的注册报告   MTN  ...  2024-03-15    40
[50 rows x 7 columns]
```

### 实现要点

1. **后端实现**：
   - 实现分页数据获取
   - 实现批量多页获取
   - 实现数据去重

2. **前端实现**：
   - 数据概览：总注册数量、总金额、品种分布
   - 分页加载
   - 数据可视化：
     - 品种分布饼图
     - 注册金额统计
     - 项目状态分布

3. **数据模型**：
   ```python
   {
       "债券名称": str,
       "品种": str,
       "注册或备案": str,
       "金额": float,  # 亿元
       "注册通知书文号": str,
       "更新日期": str,
       "项目状态": str,
       "更新时间": datetime
   }
   ```

### 扩展功能（可选）

1. 品种分类统计
2. 发行主体分析
3. 注册金额趋势

---

## ✅ 实现状态

**状态**: ✅ 已完成后端实现

**完成时间**: 2024-11-23

**实现内容**:
- ✅ 创建测试用例文件：`tests/bonds/collections/10_bond_debt_nafmii_collection.py`
- ✅ 实现银行间债券发行数据测试
- ✅ **后端服务层实现**：`BondDataService.save_bond_debt_nafmii()` 和 `query_bond_debt_nafmii()`
- ✅ **数据库索引**：债券名称+注册通知书文号联合唯一索引、品种索引、更新日期索引、项目状态索引
- ✅ **API端点实现**：
  - `GET /api/bonds/debt-nafmii` - 查询债券发行数据（支持搜索、筛选、分页、排序）
  - `POST /api/bonds/debt-nafmii/refresh` - 刷新指定页的债券发行数据
  - `POST /api/bonds/debt-nafmii/batch-refresh` - 批量刷新多页数据
- ⏳ 后续需要：前端页面实现

**测试运行**:
```bash
# 运行测试用例
pytest tests/bonds/collections/10_bond_debt_nafmii_collection.py -v

# 测试API（需要先启动后端服务）
# 查询债券发行数据
curl -X GET "http://localhost:8000/api/bonds/debt-nafmii?page=1&page_size=100&bond_type=SCP"

# 刷新单页数据（每页50条）
curl -X POST "http://localhost:8000/api/bonds/debt-nafmii/refresh?page=1"

# 批量刷新（第1-10页）
curl -X POST "http://localhost:8000/api/bonds/debt-nafmii/batch-refresh?start_page=1&end_page=10"
```

**集合信息**:
- 集合名称：`bond_debt_nafmii`
- 唯一标识：`债券名称` + `注册通知书文号`（联合主键）
- 数据来源：中国银行间市场交易商协会（NAFMII）
- API接口：`bond_debt_nafmii`

**技术实现细节**:
1. 数据模型包含7个字段：债券名称、品种、注册或备案、金额（亿元）、注册通知书文号、更新日期、项目状态
2. 使用联合主键（债券名称+注册通知书文号）确保数据唯一性
3. 支持分页获取：每次AKShare返回50条数据
4. 支持按债券名称搜索
5. 支持按品种筛选（SCP超短期融资券、MTN中期票据、CP短期融资券等）
6. 支持按项目状态筛选
7. 批量刷新接口支持页码范围

**数据特点**:
- 非金融企业债务融资工具：覆盖SCP、MTN、CP、PPN等品种
- 注册信息：包含注册通知书文号、注册或备案状态
- 项目状态：跟踪项目进展状态（编号20、40等）
- 金额单位：注册金额以亿元为单位
- 分页数据：每页50条，需要循环获取完整数据

**使用场景**:
1. **债券发行监控**：追踪银行间市场债券注册情况
2. **品种分析**：分析不同债券品种的发行量
3. **发行主体研究**：研究企业的融资行为
4. **注册进度追踪**：查看项目注册状态变化
5. **市场规模统计**：统计不同品种的发行规模

**下一步**:
- 前端页面开发（数据表格、品种分布饼图、金额统计）
- 定时任务（每日自动更新新增数据）
- 品种分类统计功能
- 发行主体分析工具
- 数据导出功能（Excel、CSV）
