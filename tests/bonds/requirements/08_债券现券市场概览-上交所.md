### 背景
债券现券市场概览提供了债券市场的整体托管情况，是了解债券市场规模和结构的重要数据。

### 任务

建立债券现券市场概览数据集合，参考下面获取数据的API接口和字段，获取上交所债券现券市场的概览数据。

### 步骤

4. 数据唯一标识：以**债券类型和数据日期**作为唯一标识

### 测试驱动
1. 测试用例文件：`tests/bonds/collections/08_bond_cash_summary_sse_collection.py`
2. 先写具体的测试用例
3. 开发实现相应的前端和后端功能
4. 运行测试，修复测试失败的问题

### 验收标准
1. 测试用例能够全部通过
2. 数据能够正确获取、存储和展示
3. 支持按日期查询和时间序列分析

### 获取数据的API接口、字段等

#### 债券现券市场概览-上交所

**接口**: `bond_cash_summary_sse`

**目标地址**: https://bond.sse.com.cn/data/statistics/overview/bondow/

**描述**: 上登债券信息网-市场数据-市场统计-市场概览-债券现券市场概览

**限量**: 单次返回指定交易日的债券现券市场概览数据

**输入参数**

| 名称   | 类型  | 描述              |
|------|-----|-----------------|
| date | str | date='20200111' |

**输出参数**

| 名称   | 类型      | 描述       |
|------|---------|----------|
| 债券现货 | object  | -        |
| 托管只数 | int64   | -        |
| 托管市值 | float64 | 注意单位: 亿元 |
| 托管面值 | float64 | 注意单位: 亿元 |
| 数据日期 | object  | -        |

**接口示例**

```python
import akshare as ak

bond_cash_summary_sse_df = ak.bond_cash_summary_sse(date='20210111')
print(bond_cash_summary_sse_df)
```

**数据示例**

```
        债券现货   托管只数       托管市值       托管面值        数据日期
0         国债    193    6815.47    6758.46  2021-01-11
1        地方债   5317    6713.69    6709.22  2021-01-11
2        金融债     19     989.76     970.70  2021-01-11
3        企业债   2233    7497.15    7433.93  2021-01-11
4  非公开发行公司债券   4974   43857.61   44191.15  2021-01-11
5       可交换债     57    1352.85    1280.10  2021-01-11
6   公开发行公司债券   3393   46382.41   46644.57  2021-01-11
7     可转换公司债    142    3655.79    3179.81  2021-01-11
8     资产支持证券   4141   14838.03   14829.47  2021-01-11
9         合计  20469  132102.75  131997.40  2021-01-11
```

### 实现要点

1. **后端实现**：
   - 实现市场概览数据获取、存储、更新逻辑
   - 实现按日期查询
   - 实现批量更新（日期范围）
   - 实现数据聚合和统计

2. **前端实现**：
   - 实现数据概览组件：
     - 总托管市值
     - 总托管面值
     - 债券类型分布
   - 实现数据列表组件
   - 实现日期选择器
   - 增加数据可视化：
     - 各类型债券托管市值占比饼图
     - 托管市值时间序列图
     - 债券类型对比柱状图

3. **数据模型**：
   ```python
   {
       "债券类型": str,  # 联合主键
       "数据日期": str,  # 联合主键
       "托管只数": int,
       "托管市值": float,  # 亿元
       "托管面值": float,  # 亿元
       "更新时间": datetime,
       "数据来源": "sse"
   }
   ```

4. **注意事项**：
   - 只能查询特定交易日的数据
   - 批量更新时需要遍历日期
   - 数据按债券类型分类展示

### 扩展功能（可选）

1. 时间序列分析
2. 债券类型对比分析
3. 市值增长趋势分析
4. 数据导出功能

---

## ✅ 实现状态

**状态**: ✅ 已完成后端实现

**完成时间**: 2024-11-23

**实现内容**:
- ✅ 创建测试用例文件：`tests/bonds/collections/08_bond_cash_summary_sse_collection.py`
- ✅ 实现市场概览数据测试（联合主键：债券类型+日期）
- ✅ **后端服务层实现**：`BondDataService.save_bond_cash_summary_sse()` 和 `query_bond_cash_summary_sse()`
- ✅ **数据库索引**：债券类型+日期联合唯一索引、日期索引、债券类型索引
- ✅ **API端点实现**：
  - `GET /api/bonds/cash-summary-sse` - 查询市场概览（支持日期、类型筛选、分页）
  - `POST /api/bonds/cash-summary-sse/refresh` - 刷新指定日期的市场概览数据
  - `POST /api/bonds/cash-summary-sse/batch-refresh` - 批量刷新日期范围内的数据
- ⏳ 后续需要：前端页面实现

**测试运行**:
```bash
# 运行测试用例
pytest tests/bonds/collections/08_bond_cash_summary_sse_collection.py -v

# 测试API（需要先启动后端服务）
# 查询市场概览
curl -X GET "http://localhost:8000/api/bonds/cash-summary-sse?date=2021-01-11&page=1&page_size=20"

# 刷新单日数据
curl -X POST "http://localhost:8000/api/bonds/cash-summary-sse/refresh?date=20210111"

# 批量刷新
curl -X POST "http://localhost:8000/api/bonds/cash-summary-sse/batch-refresh?start_date=20210101&end_date=20210131"
```

**集合信息**:
- 集合名称：`bond_cash_summary_sse`
- 唯一标识：`债券现货` + `数据日期`（联合主键）
- 数据来源：上海证券交易所
- API接口：`bond_cash_summary_sse`

**技术实现细节**:
1. 数据模型包含5个字段：债券现货（债券类型）、数据日期、托管只数、托管市值（亿元）、托管面值（亿元）
2. 使用联合主键（债券类型+日期）确保数据唯一性
3. 支持按日期查询某一天的所有债券类型数据
4. 支持按债券类型筛选
5. 批量刷新接口支持日期范围，自动生成日期列表
6. 按日期倒序、托管市值倒序排序

**数据特点**:
- 市场统计：每日不同债券类型的托管情况
- 全面覆盖：包含国债、地方债、金融债、企业债、公司债、可转债、可交换债、资产支持证券等
- 金额巨大：托管市值以亿元为单位
- 日度更新：每个交易日更新一次

**使用场景**:
1. **市场概览**：查看某日市场整体托管情况
2. **类型分析**：对比不同债券类型的市场规模
3. **趋势分析**：追踪市场托管规模的变化
4. **占比计算**：分析各类型债券的市场占比
5. **历史对比**：对比不同日期的市场数据

**下一步**:
- 前端页面开发（饼图、柱状图、时间序列图）
- 定时任务（每日自动更新前一交易日数据）
- 市场分析工具（占比计算、增长率分析）
- 数据导出功能（Excel、CSV）
