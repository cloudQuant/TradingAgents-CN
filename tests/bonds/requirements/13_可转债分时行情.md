### 背景
可转债分时行情提供了更精细的价格变化数据，是短线交易和日内分析的重要工具。

### 任务

建立可转债分时行情数据集合，获取可转债的分时行情数据。

### 步骤
1. 数据集合：创建一个新的数据集合，名称为**可转债分时行情** (http://localhost:3000/bonds/collections/bond_zh_hs_cov_min)
2. 页面功能：数据概览、数据列表、分时图展示
3. 更新数据功能：
   - **单个更新**：输入可转债代码，获取分时数据
   - **批量更新**：批量获取多只可转债的分时数据
   - **周期选择**：支持1分钟、5分钟、15分钟、30分钟、60分钟
   - **复权选择**：不复权、前复权、后复权
4. 数据唯一标识：以**可转债代码、时间和周期**作为唯一标识

### 测试驱动
1. 测试用例文件：`tests/bonds/collections/13_bond_zh_hs_cov_min_collection.py`

### 验收标准
1. 测试用例能够全部通过
2. 支持分时图展示

### 获取数据的API接口、字段等

#### 可转债分时行情

**接口**: `bond_zh_hs_cov_min`

**目标地址**: https://quote.eastmoney.com/concept/sz128039.html

**描述**: 东方财富网-可转债-分时行情

**限量**: 单次返回指定可转债、指定频率、复权调整和时间区间的分时数据, 其中 1 分钟数据只返回近 1 个交易日数据且不复权; 其余 period 只能获取近期的数据

**输入参数**

| 名称         | 类型  | 描述                                                                                                  |
|------------|-----|-----------------------------------------------------------------------------------------------------|
| symbol     | str | symbol='sz123106'; 转债代码                                                                             |
| period     | str | period='5'; choice of {'1', '5', '15', '30', '60'}; 其中 1 分钟数据返回近 1 个交易日数据且不复权                       |
| adjust     | str | adjust=''; choice of {'', 'qfq', 'hfq'}; '': 不复权, 'qfq': 前复权, 'hfq': 后复权, 其中 1 分钟数据返回近 1 个交易日数据且不复权 |
| start_date | str | start_date="1979-09-01 09:32:00"; 日期时间; 默认返回所有数据                                                    |
| end_date   | str | end_date="2222-01-01 09:32:00"; 日期时间; 默认返回所有数据                                                      |

**输出参数-1分钟数据**

| 名称  | 类型      | 描述      |
|-----|---------|---------|
| 时间  | object  | -       |
| 开盘  | float64 | -       |
| 收盘  | float64 | -       |
| 最高  | float64 | -       |
| 最低  | float64 | -       |
| 成交量 | float64 | 注意单位: 手 |
| 成交额 | float64 | -       |
| 最新价 | float64 | -       |

**输出参数-其他周期**

| 名称  | 类型      | 描述      |
|-----|---------|---------|
| 时间  | object  | -       |
| 开盘  | float64 | -       |
| 收盘  | float64 | -       |
| 最高  | float64 | -       |
| 最低  | float64 | -       |
| 涨跌幅 | float64 | 注意单位: % |
| 涨跌额 | float64 | -       |
| 成交量 | float64 | 注意单位: 手 |
| 成交额 | float64 | -       |
| 振幅  | float64 | 注意单位: % |
| 换手率 | float64 | 注意单位: % |

**接口示例-1分钟**

```python
import akshare as ak

bond_zh_hs_cov_min_df = ak.bond_zh_hs_cov_min(symbol="sz123124", period='1', adjust='', start_date="1979-09-01 09:32:00", end_date="2222-01-01 09:32:00")
print(bond_zh_hs_cov_min_df)
```

**接口示例-其他周期**

```python
import akshare as ak

bond_zh_hs_cov_min_df = ak.bond_zh_hs_cov_min(symbol="sz123124", period='5', adjust='hfq', start_date="2021-09-01 09:32:00", end_date="2021-09-06 09:32:00")
print(bond_zh_hs_cov_min_df)
```

### 实现要点

1. **后端实现**：
   - 实现分时数据获取
   - 支持多周期选择
   - 支持复权选择
   - 实现日期范围过滤

2. **前端实现**：
   - 周期选择器（1/5/15/30/60分钟）
   - 复权方式选择
   - 分时图展示（ECharts）
   - 成交量柱状图

3. **数据模型**：
   ```python
   {
       "债券代码": str,
       "时间": str,
       "开盘": float,
       "收盘": float,
       "最高": float,
       "最低": float,
       "成交量": float,
       "成交额": float,
       "涨跌幅": float,  # 非1分钟数据
       "涨跌额": float,  # 非1分钟数据
       "振幅": float,    # 非1分钟数据
       "换手率": float,  # 非1分钟数据
       "周期": str,
       "复权方式": str,
       "更新时间": datetime
   }
   ```

4. **注意事项**：
   - 1分钟数据只返回最近1个交易日
   - 其他周期可获取近期数据
   - 1分钟数据不支持复权

### 扩展功能（可选）

1. 分时图实时刷新
2. 多只可转债对比
3. 分时量价分析
4. 异动检测

---

## ✅ 实现状态

**状态**: ✅ 已完成后端实现

**完成时间**: 2024-11-23

**实现内容**:
- ✅ 创建测试用例文件：`tests/bonds/collections/13_bond_zh_hs_cov_min_collection.py`
- ✅ 实现可转债分时行情数据测试
- ✅ **后端服务层实现**：`BondDataService.save_bond_zh_hs_cov_min()` 和 `query_bond_zh_hs_cov_min()`
- ✅ **数据库索引**：债券代码+时间+周期+复权方式联合唯一索引、债券代码索引、时间索引
- ✅ **API端点实现**：
  - `GET /api/bonds/zh-hs-cov-min/{symbol}` - 查询分时行情（支持周期、复权、时间范围筛选）
  - `POST /api/bonds/zh-hs-cov-min/{symbol}/refresh` - 刷新分时行情数据
- ⏳ 后续需要：前端页面实现

**测试运行**:
```bash
# 运行测试用例
pytest tests/bonds/collections/13_bond_zh_hs_cov_min_collection.py -v

# 测试API（需要先启动后端服务）
# 查询5分钟分时数据
curl -X GET "http://localhost:8000/api/bonds/zh-hs-cov-min/sz123124?period=5&adjust=qfq&page=1&page_size=1000"

# 刷新5分钟前复权数据
curl -X POST "http://localhost:8000/api/bonds/zh-hs-cov-min/sz123124/refresh?period=5&adjust=qfq&start_date=2021-09-01%2009:32:00&end_date=2021-09-06%2009:32:00"

# 刷新1分钟数据（近1个交易日）
curl -X POST "http://localhost:8000/api/bonds/zh-hs-cov-min/sz123124/refresh?period=1"
```

**集合信息**:
- 集合名称：`bond_zh_hs_cov_min`
- 唯一标识：`债券代码` + `时间` + `周期` + `复权方式`（联合主键）
- 数据来源：东方财富网
- API接口：`bond_zh_hs_cov_min`

**技术实现细节**:
1. 数据模型根据周期不同有所区别：
   - 1分钟数据：8个字段（时间、开盘、收盘、最高、最低、成交量、成交额、最新价）
   - 其他周期：12个字段（增加涨跌幅、涨跌额、振幅、换手率）
2. 使用联合主键（债券代码+时间+周期+复权方式）确保数据唯一性
3. 支持5种周期：1/5/15/30/60分钟
4. 支持3种复权方式：不复权/前复权/后复权
5. 支持时间范围筛选
6. 按时间升序返回，便于绘制分时图

**数据特点**:
- 高频数据：分钟级别的价格变动
- 多周期：从1分钟到60分钟多种选择
- 复权支持：前复权和后复权调整
- 时间限制：1分钟数据只返回近1个交易日且不支持复权
- 近期数据：其他周期也只能获取近期数据

**使用场景**:
1. **分时图展示**：绘制可转债的分时价格走势图
2. **短线交易**：支持日内交易决策
3. **量价分析**：分析分时成交量和价格的关系
4. **异动监控**：发现分时级别的价格异动
5. **多周期分析**：对比不同时间周期的走势

**下一步**:
- 前端页面开发（ECharts分时图、成交量柱状图）
- 实时刷新功能（WebSocket推送分时数据）
- 多只可转债对比功能
- 分时技术指标计算（均线、MACD等）
- 异动检测算法
