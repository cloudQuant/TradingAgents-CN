### 背景
可转债比价表综合展示了可转债与正股的价格关系，是可转债投资的重要分析工具。

### 任务

建立可转债比价表数据集合，获取可转债与正股的比价数据。

### 步骤
1. 数据集合：创建一个新的数据集合，名称为**可转债比价表** (http://localhost:3000/bonds/collections/bond_cov_comparison)
2. 页面功能：数据概览、数据列表、实时刷新
3. 更新数据功能：
   - **实时更新**：支持定时自动刷新
   - **全量获取**：一次性获取所有比价数据
4. 数据唯一标识：以**转债代码**作为唯一标识

### 测试驱动
1. 测试用例文件：`tests/bonds/collections/17_bond_cov_comparison_collection.py`

### 验收标准
1. 测试用例能够全部通过
2. 支持转股溢价率排序和筛选

### 获取数据的API接口、字段等

#### 可转债比价表

**接口**: `bond_cov_comparison`

**目标地址**: https://quote.eastmoney.com/center/fullscreenlist.html#convertible_comparison

**描述**: 东方财富网-行情中心-债券市场-可转债比价表

**限量**: 单次返回当前交易时刻的所有可转债比价数据

**输入参数**

| 名称  | 类型  | 描述  |
|-----|-----|-----|
| -   | -   | -   |

**输出参数**

| 名称    | 类型      | 描述      |
|-------|---------|---------|
| 序号    | int32   | -       |
| 转债代码  | object  | -       |
| 转债名称  | object  | -       |
| 转债最新价 | object  | -       |
| 转债涨跌幅 | object  | 注意单位: % |
| 正股代码  | object  | -       |
| 正股名称  | object  | -       |
| 正股最新价 | object  | -       |
| 正股涨跌幅 | object  | 注意单位: % |
| 转股价   | object  | -       |
| 转股价值  | object  | -       |
| 转股溢价率 | object  | 注意单位: % |
| 纯债溢价率 | object  | 注意单位: % |
| 回售触发价 | object  | -       |
| 强赎触发价 | object  | -       |
| 到期赎回价 | object  | -       |
| 纯债价值  | float64 | -       |
| 开始转股日 | object  | -       |
| 上市日期  | object  | -       |
| 申购日期  | object  | -       |

**接口示例**

```python
import akshare as ak

bond_cov_comparison_df = ak.bond_cov_comparison()
print(bond_cov_comparison_df)
```

**数据示例**

```
      序号 转债代码  转债名称  转债最新价  ... 纯债价值   开始转股日  上市日期   申购日期
0      1  127105   龙星转债        -  ...   87.5843  20240807  20240306  20240201
1      2  123240   楚天转债        -  ...   95.2117  20240806  20240229  20240131
...
[550 rows x 20 columns]
```

### 实现要点

1. **后端实现**：
   - 实现比价数据获取
   - 实现实时更新
   - 计算相关性指标

2. **前端实现**：
   - 实时数据刷新
   - 溢价率排序
   - 双低策略筛选器
   - 数据可视化：
     - 转股溢价率散点图
     - 正股与转债涨跌对比

3. **数据模型**：
   ```python
   {
       "序号": int,
       "转债代码": str,
       "转债名称": str,
       "转债最新价": float,
       "转债涨跌幅": float,
       "正股代码": str,
       "正股名称": str,
       "正股最新价": float,
       "正股涨跌幅": float,
       "转股价": float,
       "转股价值": float,
       "转股溢价率": float,
       "纯债溢价率": float,
       "回售触发价": float,
       "强赎触发价": float,
       "到期赎回价": float,
       "纯债价值": float,
       "开始转股日": str,
       "上市日期": str,
       "申购日期": str,
       "双低值": float,  # 计算得出：价格+溢价率
       "更新时间": datetime
   }
   ```

4. **注意事项**：
   - 部分字段可能为字符串，需要类型转换

---

## ✅ 实现状态

**状态**: ✅ 已完成后端实现

**完成时间**: 2024-11-23

**实现内容**:
- ✅ **后端服务层实现**：`save_bond_cov_comparison()` 和 `query_bond_cov_comparison()`
- ✅ **数据库索引**：转债代码唯一索引、转股溢价率索引、双低值索引
- ✅ **API端点实现**：
  - `GET /api/bonds/cov-comparison` - 查询可转债比价表
  - `POST /api/bonds/cov-comparison/refresh` - 刷新比价数据

**完成率：15/32 = 46.88%** 🎉
   - 双低策略需要计算：转债价格+转股溢价率

### 扩展功能（可选）

1. 双低策略排名
2. 溢价率异常提醒
3. 正股转债联动分析
4. 强赎风险提示
