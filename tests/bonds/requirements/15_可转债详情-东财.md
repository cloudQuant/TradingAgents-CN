### 背景
可转债详情提供了可转债的完整信息，包括基本信息、中签号、筹资用途、重要日期等。

### 任务

建立可转债详情数据集合，获取可转债的详细信息。

### 步骤

4. 数据唯一标识：以**可转债代码和指标类型**作为唯一标识

### 测试驱动
1. 测试用例文件：`tests/bonds/collections/15_bond_zh_cov_info_collection.py`

### 验收标准
1. 测试用例能够全部通过
2. 支持多种指标类型查询

### 获取数据的API接口、字段等

#### 可转债详情-东财

**接口**: `bond_zh_cov_info`

**目标地址**: https://data.eastmoney.com/kzz/detail/123121.html

**描述**: 东方财富网-数据中心-新股数据-可转债详情

**限量**: 单次返回指定 symbol 的可转债详情数据

**输入参数**

| 名称        | 类型  | 描述                                                                                  |
|-----------|-----|-------------------------------------------------------------------------------------|
| symbol    | str | symbol="123121"; 可转债代码                                                              |
| indicator | str | indicator="基本信息"; choice of {"基本信息", "中签号", "筹资用途", "重要日期"}, 其中 "可转债重要条款" 在 "基本信息中" |

**输出参数**

| 名称   | 类型     | 描述        |
|------|--------|-----------|
| 债券代码 | object | 返回 67 个字段 |

**接口示例**

```python
import akshare as ak

bond_zh_cov_info_df = ak.bond_zh_cov_info(symbol="123121", indicator="基本信息")
print(bond_zh_cov_info_df)
```

**数据示例**

```
  SECURITY_CODE   SECUCODE TRADE_MARKET  ... IS_CONVERT_STOCK IS_REDEEM IS_SELLBACK
0        123121  123121.SZ       CNSESZ  ...                是         是           是
```

### 实现要点

1. **后端实现**：
   - 实现多种指标类型的数据获取
   - 实现数据解析和格式化
   - 实现批量获取

2. **前端实现**：
   - 指标类型选择器
   - 详情展示（表格或卡片形式）
   - 重要条款突出显示

3. **数据模型**：
   ```python
   {
       "债券代码": str,
       "指标类型": str,
       "详情数据": dict,  # JSON格式存储所有字段
       "更新时间": datetime
   }
   ```

4. **注意事项**：
   - 不同指标类型返回的字段不同
   - 需要灵活处理字段结构

### 扩展功能（可选）

1. 条款解析和说明
2. 关键信息提取
3. 数据对比分析

---

## ✅ 实现状态

**状态**: ✅ 已完成后端实现

**完成时间**: 2024-11-23

**实现内容**:
- ✅ 创建测试用例文件：`tests/bonds/collections/15_bond_zh_cov_info_collection.py`
- ✅ 实现可转债详情数据测试
- ✅ **后端服务层实现**：`BondDataService.save_bond_zh_cov_info()` 和 `query_bond_zh_cov_info()`
- ✅ **数据库索引**：债券代码+指标类型联合唯一索引、债券代码索引、指标类型索引
- ✅ **API端点实现**：
  - `GET /api/bonds/zh-cov-info` - 查询可转债详情（支持按债券代码、指标类型筛选）
  - `POST /api/bonds/zh-cov-info/{symbol}/refresh` - 刷新可转债详情数据
- ⏳ 后续需要：前端页面实现

**测试运行**:
```bash
# 运行测试用例
pytest tests/bonds/collections/15_bond_zh_cov_info_collection.py -v

# 测试API（需要先启动后端服务）
# 查询基本信息
curl -X GET "http://localhost:8000/api/bonds/zh-cov-info?symbol=123121&indicator=基本信息"

# 刷新基本信息
curl -X POST "http://localhost:8000/api/bonds/zh-cov-info/123121/refresh?indicator=基本信息"

# 刷新中签号
curl -X POST "http://localhost:8000/api/bonds/zh-cov-info/123121/refresh?indicator=中签号"

# 刷新筹资用途
curl -X POST "http://localhost:8000/api/bonds/zh-cov-info/123121/refresh?indicator=筹资用途"

# 刷新重要日期
curl -X POST "http://localhost:8000/api/bonds/zh-cov-info/123121/refresh?indicator=重要日期"
```

**集合信息**:
- 集合名称：`bond_zh_cov_info`
- 唯一标识：`债券代码` + `指标类型`（联合主键）
- 数据来源：东方财富网
- API接口：`bond_zh_cov_info`

**技术实现细节**:
1. 支持4种指标类型：基本信息、中签号、筹资用途、重要日期
2. 使用联合主键（债券代码+指标类型）确保数据唯一性
3. 数据以JSON格式灵活存储，支持不同指标类型的不同字段结构
4. 基本信息包含约67个字段（如债券代码、交易市场、发行规模、转股价、转股溢价率等）
5. 自动清理NaN值，转换为None以适应JSON格式
6. 支持单只债券查询或批量查询

**数据特点**:
- 多维度：4种不同的指标类型提供全方位信息
- 详细信息：基本信息包含67个字段，涵盖发行、转股、赎回等各方面
- 灵活结构：使用JSON格式存储，支持不同指标类型的字段差异
- 完整性：包含可转债重要条款信息
- 可扩展：可轻松添加新的指标类型

**使用场景**:
1. **基本信息查询**：查看可转债的基本发行信息和当前状态
2. **中签号查询**：查看可转债申购中签号码
3. **筹资用途分析**：了解债券募集资金的用途
4. **重要日期提醒**：查看转股、赎回等重要日期
5. **条款研究**：研究可转债的转股、赎回、回售等条款

**下一步**:
- 前端页面开发（卡片式详情展示、指标类型切换）
- 关键信息提取和突出显示
- 条款解析和说明功能
- 多只可转债对比功能
- 数据导出功能（Excel、PDF）
