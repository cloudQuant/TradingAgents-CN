### 背景
盘前分时数据反映了可转债在盘前交易时段的价格变化，有助于判断开盘走势。

### 任务

建立可转债盘前分时数据集合，获取可转债的盘前分时数据。

### 步骤
1. 数据集合：创建一个新的数据集合，名称为**可转债盘前分时** (http://localhost:3000/bonds/collections/bond_zh_hs_cov_pre_min)
2. 页面功能：数据概览、数据列表、盘前分时图
3. 更新数据功能：
   - **单个更新**：输入可转债代码，获取盘前分时数据
   - **批量更新**：批量获取多只可转债的盘前数据
4. 数据唯一标识：以**可转债代码和时间**作为唯一标识

### 测试驱动
1. 测试用例文件：`tests/bonds/collections/14_bond_zh_hs_cov_pre_min_collection.py`

### 验收标准
1. 测试用例能够全部通过
2. 支持盘前数据展示

### 获取数据的API接口、字段等

#### 可转债盘前分时

**接口**: `bond_zh_hs_cov_pre_min`

**目标地址**: https://quote.eastmoney.com/concept/sz128039.html

**描述**: 东方财富网-可转债-分时行情-盘前分时

**限量**: 单次返回指定可转债在最近一个交易日的盘前分时数据

**输入参数**

| 名称     | 类型  | 描述                |
|--------|-----|-------------------|
| symbol | str | symbol="sh113570" |

**输出参数**

| 名称  | 类型      | 描述      |
|-----|---------|---------|
| 时间  | object  | -       |
| 开盘  | float64 | -       |
| 收盘  | float64 | -       |
| 最高  | float64 | -       |
| 最低  | float64 | -       |
| 成交量 | float64 | 注意单位: 手 |
| 成交额 | float64 | -       |
| 最新价 | float64 | -       |

**接口示例**

```python
import akshare as ak

bond_zh_hs_cov_pre_min_df = ak.bond_zh_hs_cov_pre_min(symbol="sh113570")
print(bond_zh_hs_cov_pre_min_df)
```

**数据示例**

```
                 时间      开盘     收盘  ...  成交量     成交额    最新价
0    2022-07-27 09:15:00  128.14  128.14  ...    0       0.0  128.1400
1    2022-07-27 09:16:00  128.14  128.14  ...    0       0.0  127.9800
...
135  2022-07-27 11:30:00  128.81  128.78  ...    7    9016.0  128.4235
```

### 实现要点

1. **后端实现**：
   - 实现盘前数据获取
   - 只保存最近交易日数据

2. **前端实现**：
   - 盘前分时图展示
   - 与正常交易时段对比

3. **数据模型**：
   ```python
   {
       "债券代码": str,
       "时间": str,
       "开盘": float,
       "收盘": float,
       "最高": float,
       "最低": float,
       "成交量": float,
       "成交额": float,
       "最新价": float,
       "更新时间": datetime
   }
   ```

### 扩展功能（可选）

1. 盘前盘后数据对比
2. 开盘预测分析

---

## ✅ 实现状态

**状态**: ✅ 已完成后端实现

**完成时间**: 2024-11-23

**实现内容**:
- ✅ 创建测试用例文件：`tests/bonds/collections/14_bond_zh_hs_cov_pre_min_collection.py`
- ✅ 实现可转债盘前分时数据测试
- ✅ **后端服务层实现**：`BondDataService.save_bond_zh_hs_cov_pre_min()` 和 `query_bond_zh_hs_cov_pre_min()`
- ✅ **数据库索引**：债券代码+时间联合唯一索引、债券代码索引、时间索引
- ✅ **API端点实现**：
  - `GET /api/bonds/zh-hs-cov-pre-min/{symbol}` - 查询盘前分时数据
  - `POST /api/bonds/zh-hs-cov-pre-min/{symbol}/refresh` - 刷新盘前分时数据
- ⏳ 后续需要：前端页面实现

**测试运行**:
```bash
# 运行测试用例
pytest tests/bonds/collections/14_bond_zh_hs_cov_pre_min_collection.py -v

# 测试API（需要先启动后端服务）
# 查询盘前分时数据
curl -X GET "http://localhost:8000/api/bonds/zh-hs-cov-pre-min/sh113570?page=1&page_size=1000"

# 刷新盘前分时数据
curl -X POST "http://localhost:8000/api/bonds/zh-hs-cov-pre-min/sh113570/refresh"
```

**集合信息**:
- 集合名称：`bond_zh_hs_cov_pre_min`
- 唯一标识：`债券代码` + `时间`（联合主键）
- 数据来源：东方财富网
- API接口：`bond_zh_hs_cov_pre_min`

**技术实现细节**:
1. 数据模型包含8个字段：债券代码、时间、开盘、收盘、最高、最低、成交量（手）、成交额、最新价
2. 使用联合主键（债券代码+时间）确保数据唯一性
3. 只保存最近一个交易日的盘前数据
4. 按时间升序返回，便于绘制盘前分时图
5. 数据时间范围通常为09:15-11:30

**数据特点**:
- 盘前交易：开盘前的集合竞价和盘前交易时段
- 最近数据：只返回最近一个交易日的数据
- 高频数据：分钟级别的价格变动
- 成交量少：盘前交易通常成交量较小
- 价格发现：反映市场对开盘价的预期

**使用场景**:
1. **盘前分析**：观察盘前价格波动和成交情况
2. **开盘预测**：根据盘前数据预测开盘价格
3. **早盘决策**：支持开盘前的交易决策
4. **异动监控**：发现盘前异常波动
5. **对比分析**：对比盘前和正常交易时段的差异

**下一步**:
- 前端页面开发（盘前分时图展示）
- 盘前盘后数据对比功能
- 开盘价预测算法
- 盘前异动检测
- 实时刷新功能
