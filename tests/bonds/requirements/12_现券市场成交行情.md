### 背景
现券市场成交行情反映了债券的实际成交情况，是分析债券市场流动性和价格发现的重要数据。

### 任务

建立现券市场成交行情数据集合，获取债券市场的实时成交数据。

### 步骤
1. 数据集合：创建一个新的数据集合，名称为**现券市场成交行情** (http://localhost:3000/bonds/collections/bond_spot_deal)
2. 页面功能：数据概览、数据列表、实时刷新
3. 更新数据功能：
   - **实时更新**：支持定时自动刷新
   - **全量获取**：一次性获取所有成交数据
4. 数据唯一标识：以**债券简称和更新时间**作为唯一标识

### 测试驱动
1. 测试用例文件：`tests/bonds/collections/12_bond_spot_deal_collection.py`

### 验收标准
1. 测试用例能够全部通过
2. 支持实时成交数据监控

### 获取数据的API接口、字段等

#### 现券市场成交行情

**接口**: `bond_spot_deal`

**目标地址**: https://www.chinamoney.com.cn/chinese/mkdatabond/

**描述**: 中国外汇交易中心暨全国银行间同业拆借中心-市场数据-市场行情-债券市场行情-现券市场成交行情

**限量**: 单次返回所有即期数据

**输入参数**

| 名称  | 类型  | 描述  |
|-----|-----|-----|
| -   | -   | -   |

**输出参数**

| 名称    | 类型      | 描述       |
|-------|---------|----------|
| 债券简称  | object  | -        |
| 成交净价  | float64 | 注意单位: 元  |
| 最新收益率 | float64 | 注意单位: %  |
| 涨跌    | float64 | 注意单位: BP |
| 加权收益率 | float64 | 注意单位: %  |
| 交易量   | float64 | 注意单位: 亿  |

**接口示例**

```python
import akshare as ak

bond_spot_deal_df = ak.bond_spot_deal()
print(bond_spot_deal_df)
```

**数据示例**

```
                       债券简称    成交净价   最新收益率     涨跌   加权收益率  交易量
0                  23附息国债26  103.20  2.3000  -0.80  2.3168  NaN
1                  23附息国债18  101.31  2.3650  -0.80  2.3733  NaN
```

### 实现要点

1. **后端实现**：
   - 实现成交数据获取
   - 实现实时更新
   - 计算成交统计

2. **前端实现**：
   - 实时成交监控
   - 涨跌排行榜
   - 数据可视化：
     - 成交量TOP排行
     - 涨跌幅分布
     - 收益率分布

3. **数据模型**：
   ```python
   {
       "债券简称": str,
       "成交净价": float,
       "最新收益率": float,
       "涨跌": float,  # BP
       "加权收益率": float,
       "交易量": float,  # 亿
       "更新时间": datetime
   }
   ```

### 扩展功能（可选）

1. 成交活跃度排名
2. 价格异动监控
3. 收益率变化分析

---

## ✅ 实现状态

**状态**: ✅ 已完成后端实现

**完成时间**: 2024-11-23

**实现内容**:
- ✅ 创建测试用例文件：`tests/bonds/collections/12_bond_spot_deal_collection.py`
- ✅ 实现现券市场成交行情数据测试
- ✅ **后端服务层实现**：`BondDataService.save_bond_spot_deal()` 和 `query_bond_spot_deal()`
- ✅ **数据库索引**：债券简称唯一索引、最新收益率索引、涨跌索引、交易量索引、更新时间索引
- ✅ **API端点实现**：
  - `GET /api/bonds/spot-deal` - 查询成交行情数据（支持搜索、分页、排序）
  - `POST /api/bonds/spot-deal/refresh` - 刷新成交行情数据
- ⏳ 后续需要：前端页面实现

**测试运行**:
```bash
# 运行测试用例
pytest tests/bonds/collections/12_bond_spot_deal_collection.py -v

# 测试API（需要先启动后端服务）
# 查询成交行情
curl -X GET "http://localhost:8000/api/bonds/spot-deal?page=1&page_size=100&sort_by=交易量"

# 刷新数据
curl -X POST "http://localhost:8000/api/bonds/spot-deal/refresh"
```

**集合信息**:
- 集合名称：`bond_spot_deal`
- 唯一标识：`债券简称`
- 数据来源：中国外汇交易中心暨全国银行间同业拆借中心（CFETS）
- API接口：`bond_spot_deal`

**技术实现细节**:
1. 数据模型包含6个字段：债券简称、成交净价（元）、最新收益率（%）、涨跌（BP）、加权收益率（%）、交易量（亿）
2. 使用债券简称作为唯一标识
3. 支持按债券简称搜索
4. 支持按交易量、涨跌、收益率等多字段排序
5. 全量获取：一次性获取所有成交行情数据
6. 实时更新：反映最新的市场成交情况

**数据特点**:
- 即期成交：反映当日最新的成交情况
- 价格信息：包含成交净价和收益率
- 涨跌幅度：以基点（BP）为单位，1BP=0.01%
- 加权收益率：交易量加权计算的平均收益率
- 交易量：以亿元为单位的成交金额
- 实时性强：数据更新频率高

**使用场景**:
1. **成交监控**：实时监控债券市场成交情况
2. **涨跌排行**：查看涨幅或跌幅最大的债券
3. **活跃度分析**：通过交易量评估债券活跃度
4. **收益率分析**：对比最新收益率和加权收益率
5. **异动预警**：监控价格或收益率的异常变化

**下一步**:
- 前端页面开发（数据表格、涨跌排行榜、交易量TOP榜）
- 定时任务（实时更新成交行情）
- 异动监控功能（价格或收益率突变提醒）
- 成交统计分析（日成交量统计、活跃度排名）
- 数据导出功能（Excel、CSV）
