# 已删除的债券数据集合说明

## 变更日期
2024年11月23日

## 变更原因
根据用户需求，为了重新设计债券数据架构，删除了除"债券数据查询"和"债券基础信息"之外的所有债券相关数据集合。

## 保留的集合

### 1. bond_info_cm (债券数据查询)
- **描述**: 中国外汇交易中心债券信息查询
- **支持功能**: 按债券名称、代码、发行人、债券类型、付息方式、发行年份、承销商、评级等条件查询
- **主要字段**: code, 债券简称, 债券代码, 发行人/受托机构, 债券类型, 发行日期, 最新债项评级, 查询代码

### 2. bond_basic_info (债券基础信息)
- **描述**: 债券的基础信息
- **包含内容**: 代码、名称、类别、发行人、息票率、上市日期、到期日等
- **主要字段**: code, name, exchange, category, issuer, coupon_rate, list_date, maturity_date, type

## 已删除的集合

以下集合已被删除，将在后续根据新的设计方案重新实现：

### 行情数据类 (4个)
1. **bond_daily** - 债券历史行情
2. **bond_spot_quotes** - 债券现货报价
3. **bond_minute_quotes** - 债券分钟数据
4. **bond_indices_daily** - 债券指数

### 可转债专项 (8个)
5. **bond_cb_profiles** - 可转债档案
6. **bond_cb_valuation_daily** - 可转债估值
7. **bond_cb_comparison** - 可转债比价表
8. **bond_cb_adjustments** - 可转债转股价格调整
9. **bond_cb_redeems** - 可转债强赎
10. **bond_cb_summary** - 可转债债券概况
11. **bond_cb_list_jsl** - 集思录可转债
12. **bond_cov_list** - 可转债列表（东方财富）

### 银行间市场数据 (5个)
13. **bond_spot_quote_detail** - 现货报价明细
14. **bond_spot_deals** - 现货成交明细
15. **bond_nafmii_debts** - 银行间市场债务

### 回购数据 (2个)
16. **bond_buybacks** - 债券回购
17. **bond_buybacks_hist** - 债券回购历史

### 其他数据 (7个)
18. **bond_issues** - 债券发行
19. **bond_events** - 债券事件
20. **yield_curve_daily** - 收益率曲线
21. **yield_curve_map** - 收益率曲线映射
22. **us_yield_daily** - 美国国债收益率
23. **bond_deal_summary** - 成交概览
24. **bond_cash_summary** - 现券市场概览

**总计**: 删除了 24 个数据集合

## 代码变更

### 1. API路由 (app/routers/bonds.py)
- 修改了 `/bonds/collections` 端点，只返回2个集合
- 修改了集合映射 `collection_map`，只保留2个集合

### 2. 数据库重置脚本 (scripts/debug/reset_bonds.py)
- 更新了 `BOND_COLLECTIONS` 列表，只包含2个集合
- 简化了 `refill_minimal` 函数，移除了 yield_curve 相关代码

### 3. 新增清理脚本 (scripts/debug/cleanup_bond_collections.py)
- 创建了专门的清理脚本，用于删除不需要的集合
- 脚本会验证保留的集合并提供详细的删除报告

## 如何执行清理

### 方法1: 使用清理脚本（推荐）
```bash
# 预览将要删除的集合
python scripts/debug/cleanup_bond_collections.py

# 确认并执行删除
python scripts/debug/cleanup_bond_collections.py --confirm
```

### 方法2: 使用reset脚本
```bash
# 删除并重建索引
python scripts/debug/reset_bonds.py --drop

# 删除、重建索引并重新填充数据
python scripts/debug/reset_bonds.py --drop --refill
```

## 后续规划

1. **需求收集**: 重新评估各类债券数据的实际需求
2. **架构设计**: 设计更合理的数据结构和存储方案
3. **分阶段实现**: 按优先级逐步实现新的数据集合
4. **性能优化**: 在新的设计中考虑查询性能和存储效率

## 注意事项

⚠️ **重要提示**:
- 删除操作不可恢复，执行前请确保已备份重要数据
- 如果前端或其他服务依赖这些集合，需要同步更新相关代码
- 建议在测试环境先验证，确认无误后再在生产环境执行

## 相关文档

- [债券数据集合-债券查询第一页展示](./01_债券数据集合-债券查询第一页展示.md)
- 其他测试文档根据新的设计方案逐步更新
