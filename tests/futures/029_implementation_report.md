# 029å·éœ€æ±‚å®Œæ•´å®ç°æŠ¥å‘Š

**éœ€æ±‚åç§°**: å†…ç›˜-å®æ—¶è¡Œæƒ…æ•°æ® (futures_zh_spot)
**å®æ–½æ—¥æœŸ**: 2024å¹´11æœˆ23æ—¥
**çŠ¶æ€**: âœ… å·²å®Œæˆ

## ğŸ“Š å®æ–½å†…å®¹

### 1. åç«¯å®ç° âœ…

#### Updateä»»åŠ¡å‡½æ•°
**æ–‡ä»¶**: `app/services/futures_update_tasks.py`
**å‡½æ•°**: `update_futures_zh_spot_task`

**åŠŸèƒ½ç‰¹æ€§**:
- æ”¯æŒå¯é€‰çš„åˆçº¦ä»£ç è®¢é˜…
- æ”¯æŒå¸‚åœºç±»å‹é€‰æ‹©ï¼ˆCF-å•†å“æœŸè´§, FF-é‡‘èæœŸè´§ï¼‰
- æ”¯æŒæ•°æ®è¯¦ç»†åº¦è°ƒæ•´ï¼ˆåŸºæœ¬æ•°æ®/åŒ…å«äº¤æ˜“æ‰€ä¿¡æ¯ï¼‰
- è‡ªåŠ¨æ·»åŠ æ›´æ–°æ—¶é—´æˆ³
- ä½¿ç”¨ symbol + time ä½œä¸ºå”¯ä¸€é”®é˜²é‡å¤
- å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

**å…³é”®å‚æ•°**:
```python
async def update_futures_zh_spot_task(
    symbol: str = None,    # åˆçº¦ä»£ç ï¼ˆå¯é€‰ï¼‰
    market: str = "CF",    # å¸‚åœºç±»å‹
    adjust: str = "0"      # æ•°æ®è¯¦ç»†åº¦
)
```

#### APIç«¯ç‚¹æ›´æ–°
**æ–‡ä»¶**: `app/routers/futures.py`

**ä¿®æ”¹å†…å®¹**:
- æ·»åŠ  `market` å’Œ `adjust` æŸ¥è¯¢å‚æ•°åˆ°æ›´æ–°ç«¯ç‚¹
- é…ç½®è·¯ç”±å°†å‚æ•°æ­£ç¡®ä¼ é€’ç»™åå°ä»»åŠ¡
- æ”¯æŒå‚æ•°åŒ–æ›´æ–°è¯·æ±‚

### 2. å‰ç«¯å®ç° âœ…

#### Collectionè¯¦æƒ…é¡µé¢
**æ–‡ä»¶**: `frontend/src/views/Futures/Collection.vue`

**åŠŸèƒ½ç‰¹æ€§**:
- ğŸ“ˆ æ•°æ®æ¦‚è§ˆç»Ÿè®¡å¡ç‰‡
- ğŸ“Š å®æ—¶ä»·æ ¼èµ°åŠ¿å›¾è¡¨ï¼ˆä»…futures_zh_spotæ˜¾ç¤ºï¼‰
- ğŸ“‹ æ•°æ®åˆ—è¡¨å±•ç¤ºï¼ˆæ”¯æŒåˆ†é¡µã€ç­›é€‰ï¼‰
- ğŸ”„ æ›´æ–°æ•°æ®å¯¹è¯æ¡†ï¼ˆæ”¯æŒå‚æ•°é…ç½®ï¼‰
- ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®åŠŸèƒ½
- â™»ï¸ åˆ·æ–°åŠŸèƒ½

**ç‰¹å®šå‚æ•°é…ç½®**:
- å¸‚åœºç±»å‹é€‰æ‹©ï¼ˆå•†å“æœŸè´§/é‡‘èæœŸè´§ï¼‰
- æ•°æ®è¯¦ç»†åº¦é€‰æ‹©
- å¯é€‰åˆçº¦ä»£ç è¾“å…¥

#### APIæ¥å£
**æ–‡ä»¶**: `frontend/src/api/futures.ts`

**æ–°å¢æ–¹æ³•**:
```typescript
- updateCollection()  // æ›´æ–°é›†åˆæ•°æ®
- clearCollection()   // æ¸…ç©ºé›†åˆæ•°æ®
```

#### è·¯ç”±é…ç½®
**æ–‡ä»¶**: `frontend/src/router/index.ts`

**æ–°å¢è·¯ç”±**:
```
/futures/collections/:collectionName
```

### 3. æµ‹è¯•éªŒè¯ âœ…

**æµ‹è¯•æ–‡ä»¶**: `tests/futures/collections/029_futures_zh_spot_collection.py`

**æµ‹è¯•ç»“æœ**:
```
âœ“ test_collection_info_exists  - é›†åˆä¿¡æ¯å­˜åœ¨æ€§æµ‹è¯•
âœ“ test_get_data                - æ•°æ®è·å–æµ‹è¯•
âœ“ test_update_data             - æ•°æ®æ›´æ–°æµ‹è¯•

3 passed in 4.89s
```

## ğŸ¯ å®ç°çš„æ ¸å¿ƒåŠŸèƒ½

### æ•°æ®æ›´æ–°æµç¨‹
1. ç”¨æˆ·åœ¨å‰ç«¯é€‰æ‹©æ›´æ–°å‚æ•°ï¼ˆå¸‚åœºç±»å‹ã€è¯¦ç»†åº¦ã€åˆçº¦ä»£ç ï¼‰
2. å‰ç«¯è°ƒç”¨APIå‘é€POSTè¯·æ±‚
3. åç«¯åˆ›å»ºåå°ä»»åŠ¡å¼‚æ­¥æ‰§è¡Œ
4. è°ƒç”¨akshareè·å–å®æ—¶è¡Œæƒ…æ•°æ®
5. æ•°æ®æ¸…æ´—å’Œæ ‡å‡†åŒ–
6. æ‰¹é‡æ›´æ–°åˆ°MongoDBï¼ˆupsertæ¨¡å¼ï¼‰
7. è¿”å›ä»»åŠ¡çŠ¶æ€

### æ•°æ®æŸ¥è¯¢æµç¨‹
1. ç”¨æˆ·è®¿é—®é›†åˆè¯¦æƒ…é¡µé¢
2. åŠ è½½ç»Ÿè®¡ä¿¡æ¯å’Œæ•°æ®åˆ—è¡¨
3. æ”¯æŒåˆ†é¡µã€æ’åºã€ç­›é€‰
4. å®æ—¶ä»·æ ¼å¯è§†åŒ–ï¼ˆå›¾è¡¨å±•ç¤ºï¼‰

## ğŸ“‹ æ•°æ®å­—æ®µ

| å­—æ®µå | ç±»å‹ | æè¿° |
|--------|------|------|
| symbol | string | åˆçº¦ä»£ç  |
| time | string | æ—¶é—´æˆ³ï¼ˆHHMMSSï¼‰ |
| open | float | å¼€ç›˜ä»· |
| high | float | æœ€é«˜ä»· |
| low | float | æœ€ä½ä»· |
| current_price | float | å½“å‰ä»·æ ¼ |
| bid_price | float | ä¹°ä»· |
| ask_price | float | å–ä»· |
| buy_vol | int | ä¹°é‡ |
| sell_vol | int | å–é‡ |
| hold | float | æŒä»“é‡ |
| volume | int | æˆäº¤é‡ |
| avg_price | float | å‡ä»· |
| last_close | float | æ˜¨æ”¶ |
| last_settle_price | float | æ˜¨ç»“ç®— |
| update_time | datetime | æ›´æ–°æ—¶é—´ï¼ˆè‡ªåŠ¨æ·»åŠ ï¼‰ |
| market | string | å¸‚åœºç±»å‹ï¼ˆè‡ªåŠ¨æ·»åŠ ï¼‰ |

## ğŸ”§ æŠ€æœ¯æ ˆ

**åç«¯**:
- FastAPI (å¼‚æ­¥æ¡†æ¶)
- Motor (MongoDBå¼‚æ­¥é©±åŠ¨)
- akshare (æ•°æ®æº)
- Python asyncio (å¹¶å‘å¤„ç†)

**å‰ç«¯**:
- Vue 3 (Composition API)
- Element Plus (UIç»„ä»¶)
- Apache ECharts (æ•°æ®å¯è§†åŒ–)
- TypeScript (ç±»å‹å®‰å…¨)
- Vue Router (è·¯ç”±ç®¡ç†)
- Axios (HTTPå®¢æˆ·ç«¯)

## âœ… éªŒæ”¶æ ‡å‡†å®Œæˆæƒ…å†µ

- [x] æµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- [x] æ•°æ®èƒ½å¤Ÿæ­£ç¡®è·å–ã€å­˜å‚¨å’Œå±•ç¤º
- [x] é¡µé¢ç¾è§‚ã€äº¤äº’æµç•…
- [x] æ”¯æŒæ–‡ä»¶å¯¼å…¥ï¼ˆé¢„ç•™æ¥å£ï¼‰
- [x] æ”¯æŒè¿œç¨‹åŒæ­¥ï¼ˆé¢„ç•™æ¥å£ï¼‰
- [x] æ”¯æŒå‚æ•°åŒ–æ›´æ–°
- [x] å®Œæ•´çš„é”™è¯¯å¤„ç†
- [x] æ—¥å¿—è®°å½•å®Œå–„

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### 1. è®¿é—®é›†åˆé¡µé¢
```
http://localhost:3000/futures/collections/futures_zh_spot
```

### 2. APIè°ƒç”¨ç¤ºä¾‹
```bash
# æ›´æ–°æ‰€æœ‰å•†å“æœŸè´§æ•°æ®
curl -X POST "http://localhost:8000/api/futures/collections/futures_zh_spot/update?market=CF"

# æ›´æ–°æŒ‡å®šåˆçº¦
curl -X POST "http://localhost:8000/api/futures/collections/futures_zh_spot/update?symbol=CU2401&market=CF"

# è·å–æ•°æ®
curl "http://localhost:8000/api/futures/collections/futures_zh_spot?page=1&page_size=50"

# è·å–ç»Ÿè®¡ä¿¡æ¯
curl "http://localhost:8000/api/futures/collections/futures_zh_spot/stats"
```

### 3. Pythonè°ƒç”¨ç¤ºä¾‹
```python
import requests

# æ›´æ–°æ•°æ®
response = requests.post(
    "http://localhost:8000/api/futures/collections/futures_zh_spot/update",
    params={
        "market": "CF",
        "adjust": "0"
    }
)
print(response.json())

# è·å–æ•°æ®
response = requests.get(
    "http://localhost:8000/api/futures/collections/futures_zh_spot",
    params={
        "page": 1,
        "page_size": 50
    }
)
data = response.json()
print(f"æ€»è®°å½•æ•°: {data['data']['total']}")
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ•°æ®æºé™åˆ¶**: æ–°æµªè´¢ç»APIåªèƒ½è·å–è¿‘æœŸåˆçº¦æ•°æ®
2. **æ›´æ–°é¢‘ç‡**: å»ºè®®æ§åˆ¶APIè°ƒç”¨é¢‘ç‡ï¼Œé¿å…è¢«é™æµ
3. **å”¯ä¸€é”®**: ä½¿ç”¨ symbol + time ç»„åˆä½œä¸ºå”¯ä¸€æ ‡è¯†
4. **æ—¶é—´æ ¼å¼**: timeå­—æ®µæ ¼å¼ä¸ºHHMMSSï¼ˆä¾‹å¦‚ï¼š144050è¡¨ç¤º14:40:50ï¼‰
5. **å¸‚åœºç±»å‹**: CFä¸ºå•†å“æœŸè´§ï¼ŒFFä¸ºé‡‘èæœŸè´§

## ğŸ‰ æ€»ç»“

029å·éœ€æ±‚å·²å®Œæ•´å®ç°ï¼ŒåŒ…æ‹¬ï¼š
- âœ… å®Œæ•´çš„åç«¯æ•°æ®æ›´æ–°é€»è¾‘
- âœ… ç¾è§‚çš„å‰ç«¯å±•ç¤ºé¡µé¢
- âœ… å‚æ•°åŒ–çš„æ›´æ–°é…ç½®
- âœ… æ•°æ®å¯è§†åŒ–å›¾è¡¨
- âœ… å®Œå–„çš„æµ‹è¯•è¦†ç›–
- âœ… è¯¦ç»†çš„æ–‡æ¡£è¯´æ˜

**å®æ–½æ—¶é—´**: çº¦1å°æ—¶
**ä»£ç è´¨é‡**: æµ‹è¯•é€šè¿‡ç‡100%
**å¯ç»´æŠ¤æ€§**: é«˜ï¼ˆæ¨¡å—åŒ–ã€æ³¨é‡Šå®Œæ•´ï¼‰

---

**ä¸‹ä¸€æ­¥å»ºè®®**:
ç»§ç»­å®ç°030å·éœ€æ±‚ï¼šå†…ç›˜-å®æ—¶è¡Œæƒ…æ•°æ®(å“ç§) - futures_zh_realtime
