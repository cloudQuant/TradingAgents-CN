/Users/yunjinqi/opt/anaconda3/lib/python3.11/site-packages/pytest_asyncio/plugin.py:211: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))
============================= test session starts ==============================
platform darwin -- Python 3.11.8, pytest-8.3.0, pluggy-1.5.0 -- /Users/yunjinqi/opt/anaconda3/bin/python3.11
cachedir: .pytest_cache
metadata: {'Python': '3.11.8', 'Platform': 'macOS-15.3.2-arm64-arm-64bit', 'Packages': {'pytest': '8.3.0', 'pluggy': '1.5.0'}, 'Plugins': {'Faker': '37.5.3', 'anyio': '4.11.0', 'flask': '1.3.0', 'html': '4.1.1', 'asyncio': '1.1.0', 'xdist': '3.8.0', 'time-machine': '2.16.0', 'timeout': '2.4.0', 'metadata': '3.1.1', 'rerunfailures': '14.0', 'cov': '6.2.1', 'playwright': '0.7.0', 'mock': '3.14.1', 'ordering': '0.6', 'sugar': '1.1.1', 'benchmark': '5.1.0', 'langsmith': '0.4.38', 'base-url': '2.1.0', 'dash': '2.18.2', 'picked': '0.5.1', 'requests-mock': '1.12.1'}, 'JAVA_HOME': '/opt/homebrew/Cellar/openjdk/24.0.1/libexec/openjdk.jdk/Contents/Home', 'Base URL': ''}
benchmark: 5.1.0 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
rootdir: /Users/yunjinqi/Documents/TradingAgents-CN/tests
configfile: pytest.ini
plugins: Faker-37.5.3, anyio-4.11.0, flask-1.3.0, html-4.1.1, asyncio-1.1.0, xdist-3.8.0, time-machine-2.16.0, timeout-2.4.0, metadata-3.1.1, rerunfailures-14.0, cov-6.2.1, playwright-0.7.0, mock-3.14.1, ordering-0.6, sugar-1.1.1, benchmark-5.1.0, langsmith-0.4.38, base-url-2.1.0, dash-2.18.2, picked-0.5.1, requests-mock-1.12.1
asyncio: mode=Mode.STRICT, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 0 items / 1 error

==================================== ERRORS ====================================
___ ERROR collecting futures/collections/001_futures_fees_info_collection.py ___
ImportError while importing test module '/Users/yunjinqi/Documents/TradingAgents-CN/tests/futures/collections/001_futures_fees_info_collection.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
../../../../opt/anaconda3/lib/python3.11/importlib/__init__.py:126: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
collections/001_futures_fees_info_collection.py:11: in <module>
    from app.main import app
../../app/main.py:43: in <module>
    from app.routers import currencies as currencies_router
E   ImportError: cannot import name 'currencies' from 'app.routers' (/Users/yunjinqi/Documents/TradingAgents-CN/app/routers/__init__.py)
------------------------------- Captured stdout --------------------------------
2025-11-23 14:50:20,475 | agents               | INFO     | ğŸ” [ConfigManager] åŠ è½½ .env æ–‡ä»¶: /Users/yunjinqi/Documents/TradingAgents-CN/.env
2025-11-23 14:50:20,475 | agents               | INFO     | ğŸ” [ConfigManager] åŠ è½½å‰ DASHSCOPE_API_KEY: ç©º
2025-11-23 14:50:20,478 | agents               | INFO     | ğŸ” [ConfigManager] åŠ è½½å DASHSCOPE_API_KEY: æœ‰å€¼
2025-11-23 14:50:20,478 | agents               | INFO     | ğŸ”§ [ConfigManager] å¼€å§‹åˆå§‹åŒ– MongoDB å­˜å‚¨...
2025-11-23 14:50:20,478 | agents               | INFO     | ğŸ” [ConfigManager] USE_MONGODB_STORAGE=false (è§£æä¸º: False)
2025-11-23 14:50:20,478 | agents               | INFO     | â„¹ï¸ [ConfigManager] MongoDB å­˜å‚¨æœªå¯ç”¨ï¼Œå°†ä½¿ç”¨ JSON æ–‡ä»¶å­˜å‚¨
2025-11-23 14:50:20,502 | tradingagents.init   | INFO     | ğŸš€ TradingAgents-CN æ—¥å¿—ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ
2025-11-23 14:50:20,502 | tradingagents.init   | INFO     | ğŸ“ æ—¥å¿—ç›®å½•: ./logs
2025-11-23 14:50:20,502 | tradingagents.init   | INFO     | ğŸ“Š æ—¥å¿—çº§åˆ«: INFO
2025-11-23 14:50:24,140 | tradingagents.init   | INFO     | ğŸš€ TradingAgents-CN æ—¥å¿—ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ
2025-11-23 14:50:24,140 | tradingagents.init   | INFO     | ğŸ“ æ—¥å¿—ç›®å½•: ./logs
2025-11-23 14:50:24,140 | tradingagents.init   | INFO     | ğŸ“Š æ—¥å¿—çº§åˆ«: INFO
2025-11-23 14:50:24,345 | tradingagents.config | INFO     | [runtime_settings] TA_USE_APP_CACHE evaluated -> False (source=default, env=None)
2025-11-23 14:50:24,352 | dataflows            | INFO     | âœ… [æ•°æ®æºé…ç½®] ä»æ•°æ®åº“è¯»å–åˆ°å·²å¯ç”¨çš„æ•°æ®æº: {'alpha_vantage', 'tushare', 'akshare', 'baostock', 'yahoo_finance', 'finnhub'}
2025-11-23 14:50:24,353 | dataflows            | WARNING  | âš ï¸ Tushareæ•°æ®æºä¸å¯ç”¨: API Keyæœªé…ç½®ï¼ˆæ•°æ®åº“å’Œç¯å¢ƒå˜é‡å‡æœªæ‰¾åˆ°ï¼‰
2025-11-23 14:50:24,353 | dataflows            | INFO     | âœ… AKShareæ•°æ®æºå¯ç”¨ä¸”å·²å¯ç”¨
2025-11-23 14:50:24,358 | dataflows            | INFO     | âœ… BaoStockæ•°æ®æºå¯ç”¨ä¸”å·²å¯ç”¨
2025-11-23 14:50:24,358 | agents               | INFO     | ğŸ“ ç¼“å­˜ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆï¼Œç¼“å­˜ç›®å½•: /Users/yunjinqi/Documents/TradingAgents-CN/tradingagents/dataflows/cache/data_cache
2025-11-23 14:50:24,358 | agents               | INFO     | ğŸ—„ï¸ æ•°æ®åº“ç¼“å­˜ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ
2025-11-23 14:50:24,358 | agents               | INFO     |    ç¾è‚¡æ•°æ®: âœ… å·²é…ç½®
2025-11-23 14:50:24,358 | agents               | INFO     |    Aè‚¡æ•°æ®: âœ… å·²é…ç½®
2025-11-23 14:50:24,362 | tradingagents.config.database_manager | INFO     | MongoDBå¯ç”¨: False
2025-11-23 14:50:24,362 | tradingagents.config.database_manager | INFO     | Rediså¯ç”¨: False
2025-11-23 14:50:24,362 | tradingagents.config.database_manager | INFO     | å¼€å§‹æ£€æµ‹æ•°æ®åº“å¯ç”¨æ€§...
2025-11-23 14:50:24,362 | tradingagents.config.database_manager | INFO     | âŒ MongoDB: MongoDBæœªå¯ç”¨ (MONGODB_ENABLED=false)
2025-11-23 14:50:24,362 | tradingagents.config.database_manager | INFO     | âŒ Redis: Redisæœªå¯ç”¨ (REDIS_ENABLED=false)
2025-11-23 14:50:24,362 | tradingagents.config.database_manager | INFO     | ä¸»è¦ç¼“å­˜åç«¯: file
2025-11-23 14:50:24,362 | tradingagents.config.database_manager | INFO     | æ•°æ®åº“ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ - MongoDB: False, Redis: False
2025-11-23 14:50:24,362 | tradingagents.dataflows.cache.adaptive | INFO     | è‡ªé€‚åº”ç¼“å­˜ç³»ç»Ÿåˆå§‹åŒ– - ä¸»è¦åç«¯: file
2025-11-23 14:50:24,362 | dataflows            | INFO     | âœ… è‡ªé€‚åº”ç¼“å­˜ç³»ç»Ÿå·²å¯ç”¨
2025-11-23 14:50:24,362 | dataflows            | INFO     | ğŸ“Š ç¼“å­˜é…ç½®:
2025-11-23 14:50:24,362 | dataflows            | INFO     |   ä¸»è¦åç«¯: file
2025-11-23 14:50:24,362 | dataflows            | INFO     |   MongoDB: âŒ ä¸å¯ç”¨
2025-11-23 14:50:24,362 | dataflows            | INFO     |   Redis: âŒ ä¸å¯ç”¨
2025-11-23 14:50:24,362 | dataflows            | INFO     |   é™çº§æ”¯æŒ: âœ… å¯ç”¨
2025-11-23 14:50:24,362 | agents               | INFO     | âœ… ä½¿ç”¨é›†æˆç¼“å­˜ç³»ç»Ÿï¼ˆæ”¯æŒ MongoDB/Redis/File è‡ªåŠ¨é€‰æ‹©ï¼‰
2025-11-23 14:50:24,363 | dataflows            | INFO     | âœ… ç»Ÿä¸€ç¼“å­˜ç®¡ç†å™¨å·²å¯ç”¨
2025-11-23 14:50:24,363 | dataflows            | INFO     | ğŸ“Š æ•°æ®æºç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ
2025-11-23 14:50:24,363 | dataflows            | INFO     |    MongoDBç¼“å­˜: âŒ æœªå¯ç”¨
2025-11-23 14:50:24,363 | dataflows            | INFO     |    ç»Ÿä¸€ç¼“å­˜: âœ… å·²å¯ç”¨
2025-11-23 14:50:24,363 | dataflows            | INFO     |    é»˜è®¤æ•°æ®æº: DataSourceCode.AKSHARE
2025-11-23 14:50:24,363 | dataflows            | INFO     |    å¯ç”¨æ•°æ®æº: [<DataSourceCode.AKSHARE: 'akshare'>, <DataSourceCode.BAOSTOCK: 'baostock'>]
=============================== warnings summary ===============================
../../app/models/stock_models.py:54
  /Users/yunjinqi/Documents/TradingAgents-CN/app/models/stock_models.py:54: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class StockBasicInfoExtended(BaseModel):

../../app/models/stock_models.py:153
  /Users/yunjinqi/Documents/TradingAgents-CN/app/models/stock_models.py:153: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class MarketQuotesExtended(BaseModel):

../../tradingagents/config/__init__.py:5
  /Users/yunjinqi/Documents/TradingAgents-CN/tradingagents/config/__init__.py:5: DeprecationWarning: ConfigManager is deprecated and will be removed in version 2.0 (2026-03-31). Please use app.services.config_service.ConfigService instead. See docs/DEPRECATION_NOTICE.md for migration guide.
    from .config_manager import config_manager, token_tracker, ModelConfig, PricingConfig, UsageRecord

<frozen abc>:106
  <frozen abc>:106: LangGraphDeprecatedSinceV10: AgentStatePydantic has been moved to `langchain.agents`. Please update your import to `from langchain.agents import AgentStatePydantic`. Deprecated in LangGraph V1.0 to be removed in V2.0.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR collections/001_futures_fees_info_collection.py
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
========================= 4 warnings, 1 error in 5.02s =========================
--- Logging error ---
Traceback (most recent call last):
  File "/Users/yunjinqi/opt/anaconda3/lib/python3.11/logging/__init__.py", line 1113, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/Users/yunjinqi/Documents/TradingAgents-CN/app/services/user_service.py", line 43, in __del__
    self.close()
  File "/Users/yunjinqi/Documents/TradingAgents-CN/app/services/user_service.py", line 39, in close
    logger.info("âœ… UserService MongoDB è¿æ¥å·²å…³é—­")
Message: 'âœ… UserService MongoDB è¿æ¥å·²å…³é—­'
Arguments: ()
