### 背景
分时数据是短线交易和日内分析的重要数据来源，需要建立A股分时数据集合。

### 任务

参考债券数据集合bond_info_cm和基金ETF分时行情数据集合的前端界面和后端实现的功能，获取A股的分时数据，建立新的数据集合。

### 步骤
1. 数据集合：创建一个新的数据集合，名称为**A股分时数据-东财** (http://localhost:3000/stocks/collections/stock_zh_a_hist_min_em)
2. 页面里面需要包含数据概览、数据列表、刷新、清空数据、更新数据等功能，根据后端获取到的数据和数据列表里面的数据，增加一些基本的图形展示，让整个页面更加美观
3. 更新数据这个功能需要支持：
   - **文件导入**：支持CSV/Excel文件导入
   - **远程同步**：从其他数据库同步数据
   - **批量更新**：从个股信息查询-东财或实时行情数据中获取股票代码列表，批量获取分时数据
   - **单个更新**：输入股票代码和时间范围，单独更新某只股票的分时数据
4. 数据唯一标识：以**股票代码和时间**作为唯一标识，更新数据时，如果存在重复的股票代码和时间，需要更新数据，否则需要插入数据

### 测试驱动
1. 需要认真思考研究债券数据集合bond_info_cm和基金ETF分时行情数据集合的前端界面和后端实现的功能，结合A股分时数据的API接口和字段，思考需要实现哪些功能，先写具体的测试用例，网页的测试用例可以基于selenium或者playwright来实现
2. 测试用例文件：`tests/stocks/collections/05_stock_zh_a_hist_min_em_collection.py`
3. 开发实现相应的前端和后端功能
4. 运行测试，修复测试失败的问题

### 验收标准
1. 测试用例能够全部通过
2. 手动点击没有异常情况
3. 数据能够正确获取、存储和展示
4. 页面美观、交互流畅
5. 批量更新功能能够正常运行，支持并发控制和进度显示
6. 支持不同周期和复权方式的选择

### 获取数据的API接口、字段等

#### A股分时数据-东财

**接口**: `stock_zh_a_hist_min_em`

**目标地址**: https://quote.eastmoney.com/concept/sh603777.html

**描述**: 东方财富网-行情首页-沪深京 A 股-每日分时行情; 该接口只能获取近期的分时数据，注意时间周期的设置

**限量**: 单次返回指定股票、频率、复权调整和时间区间的分时数据, 其中 **1 分钟数据只返回近 5 个交易日数据且不复权**

**输入参数**

| 名称         | 类型  | 描述                                                                                                  |
|------------|-----|-----------------------------------------------------------------------------------------------------|
| symbol     | str | symbol='000300'; 股票代码                                                                               |
| start_date | str | start_date="1979-09-01 09:32:00"; 日期时间; 默认返回所有数据                                                    |
| end_date   | str | end_date="2222-01-01 09:32:00"; 日期时间; 默认返回所有数据                                                      |
| period     | str | period='5'; choice of {'1', '5', '15', '30', '60'}; 其中 1 分钟数据返回近 5 个交易日数据且不复权                       |
| adjust     | str | adjust=''; choice of {'', 'qfq', 'hfq'}; '': 不复权, 'qfq': 前复权, 'hfq': 后复权, 其中 1 分钟数据返回近 5 个交易日数据且不复权 |

**重要说明**：
- **1分钟数据**：只能获取近5个交易日的数据，且不支持复权
- **其他周期（5/15/30/60分钟）**：可以获取更长历史数据，支持复权

**输出参数-1分钟数据**

| 名称  | 类型      | 描述      |
|-----|---------|---------|
| 时间  | object  | -       |
| 开盘  | float64 | -       |
| 收盘  | float64 | -       |
| 最高  | float64 | -       |
| 最低  | float64 | -       |
| 成交量 | float64 | 注意单位: 手 |
| 成交额 | float64 | -       |
| 均价  | float64 | -       |

**接口示例-1分钟数据**

```python
import akshare as ak

# 注意：该接口返回的数据只有最近一个交易日的有开盘价，其他日期开盘价为 0
stock_zh_a_hist_min_em_df = ak.stock_zh_a_hist_min_em(
    symbol="000001", 
    start_date="2024-03-20 09:30:00", 
    end_date="2024-03-20 15:00:00", 
    period="1", 
    adjust=""
)
print(stock_zh_a_hist_min_em_df)
```

**数据示例-1分钟数据**

```
               时间     开盘     收盘     最高     最低    成交量    成交额     均价
0    2024-03-20 09:30:00  10.38  10.38  10.38  10.38   7174   7446612.0  10.380
1    2024-03-20 09:31:00  10.38  10.40  10.40  10.38  12967  13471486.0  10.386
2    2024-03-20 09:32:00  10.40  10.41  10.41  10.39  10409  10824353.0  10.390
3    2024-03-20 09:33:00  10.41  10.41  10.41  10.40   4896   5095656.0  10.393
4    2024-03-20 09:34:00  10.40  10.39  10.41  10.39   7060   7341787.0  10.394
..                   ...    ...    ...    ...    ...    ...         ...     ...
236  2024-03-20 14:56:00  10.44  10.44  10.45  10.44   2646   2762914.0  10.431
237  2024-03-20 14:57:00  10.44  10.44  10.45  10.44   7613   7951367.0  10.431
238  2024-03-20 14:58:00  10.45  10.45  10.45  10.45    110    114850.0  10.431
239  2024-03-20 14:59:00  10.45  10.45  10.45  10.45      0         0.0  10.431
240  2024-03-20 15:00:00  10.45  10.45  10.45  10.45  13079  13667555.0  10.431
[241 rows x 8 columns]
```

**输出参数-其他周期（5/15/30/60分钟）**

| 名称  | 类型      | 描述      |
|-----|---------|---------|
| 时间  | object  | -       |
| 开盘  | float64 | -       |
| 收盘  | float64 | -       |
| 最高  | float64 | -       |
| 最低  | float64 | -       |
| 涨跌幅 | float64 | 注意单位: % |
| 涨跌额 | float64 | -       |
| 成交量 | float64 | 注意单位: 手 |
| 成交额 | float64 | -       |
| 振幅  | float64 | 注意单位: % |
| 换手率 | float64 | 注意单位: % |

**接口示例-5分钟数据**

```python
import akshare as ak

stock_zh_a_hist_min_em_df = ak.stock_zh_a_hist_min_em(
    symbol="000001", 
    start_date="2024-03-20 09:30:00", 
    end_date="2024-03-20 15:00:00", 
    period="5", 
    adjust="hfq"
)
print(stock_zh_a_hist_min_em_df)
```

**数据示例-5分钟数据**

```
             时间       开盘       收盘  ...         成交额    振幅   换手率
0   2024-03-20 09:35:00  1939.26  1940.89  ...  53652034.0  0.25  0.03
1   2024-03-20 09:40:00  1939.26  1940.89  ...  27557310.0  0.17  0.01
2   2024-03-20 09:45:00  1939.26  1939.26  ...  11556035.0  0.08  0.01
3   2024-03-20 09:50:00  1940.89  1945.76  ...  27377765.0  0.42  0.01
4   2024-03-20 09:55:00  1947.39  1944.14  ...  37867949.0  0.17  0.02
...
[48 rows x 11 columns]
```

### 实现要点

1. **后端实现**：
   - 扩展 `StockDataService` 服务类
   - 实现分时数据获取、存储、更新逻辑
   - 实现批量获取（从个股信息或实时行情获取股票代码列表）
   - 实现并发控制（避免API限流）
   - 支持周期选择（1/5/15/30/60分钟）
   - 支持复权方式选择（不复权/前复权/后复权，1分钟除外）
   - 实现文件导入和远程同步功能
   - 注意1分钟数据的特殊限制（只能获取近5个交易日）

2. **前端实现**：
   - 参考 `Funds/Collection.vue` 和 ETF基金分时行情的布局
   - 实现数据概览组件：
     - 总记录数
     - 覆盖股票数
     - 最早/最新时间
     - 数据覆盖周期
   - 实现数据列表组件：
     - 支持分页（默认每页100条）
     - 支持排序（按时间、成交量等）
     - 支持筛选（按股票代码、时间范围、周期等）
     - 支持分时图展示（可选）
   - 实现更新数据组件：
     - 文件导入
     - 远程同步
     - 批量更新配置：
       - 股票代码列表（从其他集合获取或手动输入）
       - 时间范围（开始时间、结束时间）
       - 周期（1/5/15/30/60分钟）
       - 复权方式（不复权/前复权/后复权）
       - 批量大小、并发数、延迟时间
     - 单个更新：
       - 输入股票代码
       - 时间范围
       - 周期
       - 复权方式
   - 增加数据可视化：
     - 分时图（选中某只股票查看）
     - 成交量柱状图
     - 实时买卖力道分析

3. **数据模型**：
   ```python
   # 1分钟数据
   {
       "时间": str,
       "股票代码": str,
       "开盘": float,
       "收盘": float,
       "最高": float,
       "最低": float,
       "成交量": float,
       "成交额": float,
       "均价": float,
       "周期": str,  # 1/5/15/30/60
       "复权方式": str,  # 不复权/前复权/后复权
       "更新时间": datetime
   }
   
   # 其他周期数据（5/15/30/60分钟）
   {
       "时间": str,
       "股票代码": str,
       "开盘": float,
       "收盘": float,
       "最高": float,
       "最低": float,
       "涨跌幅": float,
       "涨跌额": float,
       "成交量": float,
       "成交额": float,
       "振幅": float,
       "换手率": float,
       "周期": str,  # 1/5/15/30/60
       "复权方式": str,  # 不复权/前复权/后复权
       "更新时间": datetime
   }
   ```

4. **注意事项**：
   - **1分钟数据限制**：
     - 只能获取近5个交易日的数据
     - 不支持复权
     - 只有最近一个交易日的数据有开盘价，其他日期开盘价为0
   - **数据量巨大**：
     - 1分钟数据：每个交易日约240条
     - 5分钟数据：每个交易日约48条
     - 15分钟数据：每个交易日约16条
     - 30分钟数据：每个交易日约8条
     - 60分钟数据：每个交易日约4条
   - **存储策略**：
     - 建议按周期分别存储
     - 1分钟数据只保留近期数据（如最近30天）
     - 长期历史数据使用更大周期（如60分钟、日线）
   - API调用频率控制：建议每次请求间隔0.5-1秒
   - 批量更新时需要显示详细进度
   - 错误处理：网络异常、API限流、数据格式异常等
   - 数据验证：检查时间连续性、价格合理性等
   - 索引优化：在股票代码、时间、周期、复权方式字段上建立联合索引

5. **批量更新配置**：
   - 批量大小：建议5-20只股票为一批
   - 并发数：建议1-2（避免被限流）
   - 延迟时间：建议0.5-1秒/次
   - 时间范围：
     - 1分钟数据：建议最近5个交易日
     - 5分钟数据：建议最近20个交易日
     - 15/30/60分钟数据：可以获取更长期的历史数据

6. **性能优化**：
   - 后端：使用bulk_write进行批量upsert
   - 前端：使用虚拟列表或分页，避免一次渲染太多数据
   - 缓存：可以考虑缓存当日分时数据
   - 数据清理：定期清理过期的1分钟数据
   - 分表：按日期或股票代码分表存储

### 扩展功能（可选）

1. **分时图展示**：
   - 集成ECharts绘制分时图
   - 支持多周期切换（1/5/15/30/60分钟）
   - 支持复权切换
   - 叠加成交量柱状图
   - 支持缩放、拖动

2. **实时更新**：
   - 交易时间段内定时更新当日分时数据
   - WebSocket实时推送更新数据到前端

3. **技术分析**：
   - 计算分时均价线
   - 计算量价关系指标
   - 识别分时形态（如：V型反转、早盘冲高回落等）

4. **数据监控**：
   - 异动监控（成交量突增、价格急涨急跌等）
   - 大单监控
   - 盘口分析

5. **数据导出**：
   - 导出为CSV/Excel
   - 支持选择导出周期和字段
   - 支持按条件导出

6. **数据质量检查**：
   - 检查数据缺失（时间点缺失）
   - 检查数据异常（价格突变、成交量异常等）
   - 生成数据质量报告

7. **多周期联动**：
   - 同时查看不同周期的分时数据
   - 支持周期切换
   - 支持多只股票对比

8. **数据压缩**：
   - 对历史分时数据进行压缩存储
   - 降低存储成本

### 使用建议

1. **数据获取策略**：
   - **短线交易**：主要使用1分钟和5分钟数据
   - **波段交易**：主要使用15分钟和30分钟数据
   - **趋势分析**：主要使用60分钟和日线数据

2. **数据保留策略**：
   - 1分钟数据：保留最近30天
   - 5分钟数据：保留最近3个月
   - 15/30分钟数据：保留最近1年
   - 60分钟数据：可长期保留

3. **更新频率建议**：
   - 交易时间段：每1-5分钟更新一次当日数据
   - 收盘后：完整更新当日所有数据
   - 非交易时间：不需要更新
