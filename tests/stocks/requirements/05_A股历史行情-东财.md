### 背景
历史行情数据是量化投资研究和技术分析的基础，需要建立A股历史行情数据集合。

### 任务

参考债券数据集合bond_info_cm和基金ETF历史行情数据集合的前端界面和后端实现的功能，获取A股的历史行情数据，建立新的数据集合。

### 步骤
1. 数据集合：创建一个新的数据集合，名称为**A股历史行情-东财** (http://localhost:3000/stocks/collections/stock_zh_a_hist)
2. 页面里面需要包含数据概览、数据列表、刷新、清空数据、更新数据等功能，根据后端获取到的数据和数据列表里面的数据，增加一些基本的图形展示，让整个页面更加美观
3. 更新数据这个功能需要支持：
   - **文件导入**：支持CSV/Excel文件导入
   - **远程同步**：从其他数据库同步数据
   - **批量更新**：从个股信息查询-东财或实时行情数据中获取股票代码列表，批量获取历史行情
   - **单个更新**：输入股票代码和日期范围，单独更新某只股票的历史行情
4. 数据唯一标识：以**股票代码和日期**作为唯一标识，更新数据时，如果存在重复的股票代码和日期，需要更新数据，否则需要插入数据

### 测试驱动
1. 需要认真思考研究债券数据集合bond_info_cm和基金ETF历史行情数据集合的前端界面和后端实现的功能，结合A股历史行情的API接口和字段，思考需要实现哪些功能，先写具体的测试用例，网页的测试用例可以基于selenium或者playwright来实现
2. 测试用例文件：`tests/stocks/collections/04_stock_zh_a_hist_collection.py`
3. 开发实现相应的前端和后端功能
4. 运行测试，修复测试失败的问题

### 验收标准
1. 测试用例能够全部通过
2. 手动点击没有异常情况
3. 数据能够正确获取、存储和展示
4. 页面美观、交互流畅
5. 批量更新功能能够正常运行，支持并发控制和进度显示
6. 支持不同复权方式的选择

### 获取数据的API接口、字段等

#### A股历史行情-东财

**接口**: `stock_zh_a_hist`

**目标地址**: https://quote.eastmoney.com/concept/sh603777.html?from=classic

**描述**: 东方财富-沪深京 A 股日频率数据; 历史数据按日频率更新, 当日收盘价请在收盘后获取

**限量**: 单次返回指定沪深京 A 股上市公司、指定周期和指定日期间的历史行情日频率数据

**输入参数**

| 名称         | 类型    | 描述                                                       |
|------------|-------|----------------------------------------------------------|
| symbol     | str   | symbol='603777'; 股票代码可以在 **ak.stock_zh_a_spot_em()** 中获取 |
| period     | str   | period='daily'; choice of {'daily', 'weekly', 'monthly'} |
| start_date | str   | start_date='20210301'; 开始查询的日期                           |
| end_date   | str   | end_date='20210616'; 结束查询的日期                             |
| adjust     | str   | 默认返回不复权的数据; qfq: 返回前复权后的数据; hfq: 返回后复权后的数据               |
| timeout    | float | timeout=None; 默认不设置超时参数                                  |

**股票数据复权说明**

1. **为何要复权**：由于股票存在配股、分拆、合并和发放股息等事件，会导致股价出现较大的缺口。
   若使用不复权的价格处理数据、计算各种指标，将会导致它们失去连续性，且使用不复权价格计算收益也会出现错误。
   为了保证数据连贯性，常通过前复权和后复权对价格序列进行调整。

2. **前复权**：保持当前价格不变，将历史价格进行增减，从而使股价连续。
   前复权用来看盘非常方便，能一眼看出股价的历史走势，叠加各种技术指标也比较顺畅，是各种行情软件默认的复权方式。
   
   注意事项：
   - 为了保证当前价格不变，每次股票除权除息，均需要重新调整历史价格，因此其历史价格是时变的
   - 对于有持续分红的公司来说，前复权价可能出现负值

3. **后复权**：保证历史价格不变，在每次股票权益事件发生后，调整当前的股票价格。
   后复权价格和真实股票价格可能差别较大，不适合用来看盘。
   其优点在于，可以被看作投资者的长期财富增长曲线，反映投资者的真实收益率情况。

4. **在量化投资研究中普遍采用后复权数据**。

**输出参数**

| 名称   | 类型      | 描述          |
|------|---------|-------------|
| 日期   | object  | 交易日         |
| 股票代码 | object  | 不带市场标识的股票代码 |
| 开盘   | float64 | 开盘价         |
| 收盘   | float64 | 收盘价         |
| 最高   | float64 | 最高价         |
| 最低   | float64 | 最低价         |
| 成交量  | int64   | 注意单位: 手     |
| 成交额  | float64 | 注意单位: 元     |
| 振幅   | float64 | 注意单位: %     |
| 涨跌幅  | float64 | 注意单位: %     |
| 涨跌额  | float64 | 注意单位: 元     |
| 换手率  | float64 | 注意单位: %     |

**接口示例-不复权**

```python
import akshare as ak

stock_zh_a_hist_df = ak.stock_zh_a_hist(
    symbol="000001", 
    period="daily", 
    start_date="20170301", 
    end_date='20240528', 
    adjust=""
)
print(stock_zh_a_hist_df)
```

**数据示例-不复权**

```
            日期    股票代码   开盘   收盘  ... 振幅  涨跌幅  涨跌额 换手率
0     2017-03-01  000001   9.49   9.49  ...  0.84  0.11  0.01  0.21
1     2017-03-02  000001   9.51   9.43  ...  1.26 -0.63 -0.06  0.24
2     2017-03-03  000001   9.41   9.40  ...  0.74 -0.32 -0.03  0.20
3     2017-03-06  000001   9.40   9.45  ...  0.74  0.53  0.05  0.24
4     2017-03-07  000001   9.44   9.45  ...  0.63  0.00  0.00  0.17
...          ...     ...    ...    ...  ...   ...   ...   ...   ...
1755  2024-05-22  000001  11.56  11.56  ...  2.42  0.09  0.01  1.09
1756  2024-05-23  000001  11.53  11.40  ...  1.90 -1.38 -0.16  0.95
1757  2024-05-24  000001  11.37  11.31  ...  1.67 -0.79 -0.09  0.72
1758  2024-05-27  000001  11.31  11.51  ...  1.95  1.77  0.20  0.75
1759  2024-05-28  000001  11.50  11.40  ...  1.91 -0.96 -0.11  0.62
[1760 rows x 12 columns]
```

### 实现要点

1. **后端实现**：
   - 扩展 `StockDataService` 服务类
   - 实现历史行情数据获取、存储、更新逻辑
   - 实现批量获取（从个股信息或实时行情获取股票代码列表）
   - 实现增量更新（只更新最近N天的数据）
   - 实现并发控制（避免API限流）
   - 支持复权方式选择（不复权/前复权/后复权）
   - 支持周期选择（日线/周线/月线）
   - 实现文件导入和远程同步功能

2. **前端实现**：
   - 参考 `Funds/Collection.vue` 和 ETF基金历史行情的布局
   - 实现数据概览组件：
     - 总记录数
     - 覆盖股票数
     - 最早/最新日期
     - 数据覆盖天数
   - 实现数据列表组件：
     - 支持分页（默认每页100条）
     - 支持排序（按日期、涨跌幅等）
     - 支持筛选（按股票代码、日期范围等）
     - 支持K线图展示（可选）
   - 实现更新数据组件：
     - 文件导入
     - 远程同步
     - 批量更新配置：
       - 股票代码列表（从其他集合获取或手动输入）
       - 日期范围（开始日期、结束日期）
       - 复权方式（不复权/前复权/后复权）
       - 周期（日线/周线/月线）
       - 批量大小、并发数、延迟时间
     - 单个更新：
       - 输入股票代码
       - 日期范围
       - 复权方式
       - 周期
   - 增加数据可视化：
     - K线图（选中某只股票查看）
     - 成交量图
     - 涨跌幅分布统计

3. **数据模型**：
   ```python
   {
       "日期": str,
       "股票代码": str,
       "开盘": float,
       "收盘": float,
       "最高": float,
       "最低": float,
       "成交量": int,
       "成交额": float,
       "振幅": float,
       "涨跌幅": float,
       "涨跌额": float,
       "换手率": float,
       "复权方式": str,  # 不复权/前复权/后复权
       "周期": str,      # 日线/周线/月线
       "更新时间": datetime
   }
   ```

4. **注意事项**：
   - 历史数据量非常大，每只股票可能有数千条记录
   - 需要合理规划数据更新策略：
     - 首次导入：获取全部历史数据（可能需要很长时间）
     - 增量更新：只更新最近几天的数据
   - API调用频率控制：建议每次请求间隔0.5-1秒
   - 批量更新时需要显示详细进度（当前股票、进度百分比、预计剩余时间）
   - 错误处理：网络异常、API限流、数据格式异常、停牌股票等
   - 数据验证：检查日期连续性、价格合理性等
   - 索引优化：在股票代码、日期、复权方式字段上建立联合索引

5. **批量更新配置**：
   - 批量大小：建议10-50只股票为一批
   - 并发数：建议1-2（避免被限流）
   - 延迟时间：建议0.5-1秒/次
   - 日期范围：
     - 首次导入：建议获取近3-5年数据
     - 增量更新：只更新最近5-10个交易日

6. **性能优化**：
   - 后端：使用bulk_write进行批量upsert
   - 前端：使用虚拟列表或分页，避免一次渲染太多数据
   - 缓存：可以考虑缓存常用股票的历史数据
   - 分表：如果数据量特别大，可以考虑按年份或股票代码分表

### 扩展功能（可选）

1. **K线图展示**：
   - 集成ECharts或TradingView
   - 支持日K、周K、月K切换
   - 支持技术指标叠加（MA、MACD、KDJ等）
   - 支持缩放、拖动

2. **数据分析**：
   - 计算技术指标（移动平均线、布林带等）
   - 统计涨跌停次数
   - 计算波动率、夏普比率等指标

3. **数据导出**：
   - 导出为CSV/Excel
   - 支持选择导出字段
   - 支持按条件导出（如：某只股票、某个时间段）

4. **数据质量检查**：
   - 检查数据缺失（交易日缺失）
   - 检查数据异常（价格突变、成交量异常等）
   - 生成数据质量报告

5. **定时任务**：
   - 每日收盘后自动更新最新数据
   - 支持配置定时任务时间和范围

6. **多周期支持**：
   - 同时存储日线、周线、月线数据
   - 支持周期转换查询

7. **跨市场对比**：
   - 对比同一只股票在不同复权方式下的数据
   - 对比不同股票的历史走势
