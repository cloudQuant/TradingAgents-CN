# 股票数据集合API更新功能实现状态

## 当前实现

### 已完成的基础功能
1. ✅ **文件导入**：支持CSV/Excel文件导入到所有股票数据集合
2. ✅ **远程同步**：支持从远程MongoDB同步数据到所有股票数据集合  
3. ✅ **API更新（无参数）**：支持直接更新全部数据的集合

### 需要补充的功能
针对需要参数的数据集合（如个股信息查询需要股票代码参数），需要添加：
1. 参数输入对话框
2. 支持单个更新和批量更新
3. 参数验证和错误提示

## 实现方案

### 架构设计
1. **配置文件**：`frontend/src/views/Stocks/collectionRefreshConfig.ts`
   - 定义每个集合的刷新参数配置
   - 包括参数类型、必填性、默认值等

2. **前端组件**：`frontend/src/views/Stocks/Collection.vue`
   - 添加参数输入对话框
   - 根据配置动态显示不同的参数输入UI
   - 支持更新全部或带参数更新

3. **后端接口**：已存在的`/api/stocks/collections/{collection_name}/refresh`
   - 接收参数并传递给对应的service方法

## 实现步骤

### 步骤1：创建配置框架（已完成）
- [x] 创建`collectionRefreshConfig.ts`配置文件
- [x] 定义配置接口和类型

### 步骤2：修改前端组件（进行中）
需要在Collection.vue中添加：
- [ ] 导入refresh config
- [ ] 添加参数对话框状态管理
- [ ] 添加参数对话框UI
- [ ] 修改handleUpdateCommand处理逻辑
- [ ] 添加参数验证和提交逻辑

### 步骤3：逐个实现需求文档
按照`tests/stocks/requirements`目录中的需求文档，逐个添加配置并测试：

#### 待实现的集合（按优先级）
1. [ ] 02_个股信息查询-东财.md - `stock_individual_info_em`
2. [ ] 03_个股信息查询-雪球.md - `stock_individual_info_xq`  
3. [ ] 04_沪深京A股实时行情-东财.md
4. [ ] 05_A股历史行情-东财.md
5. [ ] 06_A股分时数据-东财.md
6. [ ] 18_京 A 股.md
7. [ ] 19_新股.md
8. [ ] 20_创业板.md
... (更多待补充)

## 下一步行动

### 推荐方案A：渐进式实现
1. 先完成Collection.vue的基础改造，支持参数对话框
2. 为02_个股信息查询-东财添加配置并测试
3. 确认功能正常后，逐个添加其他集合的配置
4. 每完成一个需求文档，在文件名后添加"-finished"标记

### 推荐方案B：简化实现
如果时间紧迫，可以采用更简单的方案：
1. 在Collection.vue中添加一个通用的参数输入对话框
2. 让用户以JSON格式输入参数
3. 无需为每个集合单独配置，更灵活但需要用户了解API参数格式

## 注意事项
1. 参数配置需要与后端API接口保持一致
2. 需要处理各种异常情况和用户输入错误
3. 批量更新时需要显示进度和错误信息
4. 某些集合可能需要先获取股票代码列表（如批量更新全部股票）

## 当前状态
- **配置文件**：已创建
- **前端组件**：待修改
- **测试**：待进行
- **文档**：本文档

最后更新：2025-11-24
