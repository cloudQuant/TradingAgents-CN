# 股票投研前端功能需求（概览 + 数据集合详情）

> 版本：v1.0  
> 范围：仅前端 UI 与交互（后端数据集合 API 已就绪）  
> 模式：测试驱动开发（TDD）

---

## 1. 背景与目标

在 `tests/stocks/股票需求01.md` 中，已经提出：

1. 把“股票分析”改成“股票投研”（已完成）
2. 在股票投研页面中新增“概览”页面
3. 在股票投研页面中新增“数据集合”页面
4. 新增股票数据集合（已通过后端 `/api/stocks/collections` 实现）

上一轮开发已经完成：
- 后端 `/api/stocks/collections` 接口
- 前端“股票投研 / 概览 / 数据集合”页面骨架

本轮任务：
- **强化“股票投研 / 概览”页面**：增加一个股票行情列表区域，使其更接近真实行情首页
- **新增“股票数据集合详情”页面**：用户点击数据集合卡片后，可以看到该集合下的数据列表

目标：
- 通过前端 UI 与交互的增强，让“股票投研”具备基础的浏览和研究能力
- 用测试驱动开发方式，实现前端逻辑的可验证性

---

## 2. 功能范围

本需求仅涉及：

1. **概览页面增强**（`/stocks/overview`）：
   - 在现有统计卡片和快速导航的基础上，增加一个“股票行情列表”模块
   - 展示若干只股票的基础行情信息

2. **数据集合详情页面**（`/stocks/collections/:collectionName`）：
   - 从“数据集合”页面点击某个集合卡片，跳转到对应集合的详情页
   - 在详情页中展示该数据集合的字段结构和部分数据记录

> 说明：后端目前尚未提供专门的“概览行情列表”和“集合数据详情”接口，本轮前端实现允许先使用**假数据 / Mock** 以完成 UI 和交互设计，为后续后端接口预留扩展点。

---

## 3. 页面与路由设计

### 3.1 路由约定

1. **概览页**（已存在）
   - 路由前缀：`/stocks`
   - 子路由：`/stocks/overview`
   - 组件：`frontend/src/views/Stocks/index.vue`

2. **数据集合列表页**（已存在）
   - 路由：`/stocks/collections`
   - 组件：`frontend/src/views/Stocks/Collections.vue`

3. **数据集合详情页**（本次新增）
   - 路由：`/stocks/collections/:collectionName`
   - 组件：`frontend/src/views/Stocks/Collection.vue`（新建）
   - 路由命名：`StocksCollectionDetail`

### 3.2 菜单与导航

1. 侧边栏“股票投研”菜单保持不变：
   - 概览：`/stocks/overview`
   - 数据集合：`/stocks/collections`

2. 新增导航方式：
   - 在“数据集合”列表页点击集合卡片，跳转到对应的 `/stocks/collections/:collectionName` 详情页
   - 在集合详情页提供“返回数据集合列表”的按钮

---

## 4. 概览页面增强需求（/stocks/overview）

### 4.1 新增模块：股票行情列表

在 `Stocks/index.vue` 中，在“功能说明”卡片 **上方** 增加一个“股票行情列表”模块，具体要求：

1. 使用 `el-card` 包裹，标题为：`市场行情一览`
2. 使用 `el-table` 展示行情列表，列包含：
   - `code`：股票代码（字符串）
   - `name`：股票名称（字符串）
   - `latest_price`：最新价（数值，保留2位小数）
   - `pct_chg`：涨跌幅（%），带颜色：
     - >0 显示红色
     - <0 显示绿色
     - =0 显示默认颜色
   - `volume`：成交量（整数，支持格式化显示，如“1.2亿”）
   - `amount`：成交额（整数，支持格式化显示，如“3.4亿”）

3. 列表数据源：
   - 当前版本：使用前端 Mock 数据（写在组件中）
   - 每次加载页面时，从一个本地常量数组中读取，例如：
     ```ts
     const mockQuotes = [
       { code: '600000.SH', name: '浦发银行', latest_price: 10.23, pct_chg: 1.23, volume: 34500000, amount: 345678900 },
       { code: '000001.SZ', name: '平安银行', latest_price: 12.34, pct_chg: -0.56, volume: 12300000, amount: 145678900 },
       // ... 至少 10 条
     ]
     ```

4. 行为：
   - 表格支持按涨跌幅、成交额排序（前端本地排序即可）
   - 点击代码或名称单元格时，跳转到股票详情页 `/stocks/:code`（与现有 StockDetail 路由兼容）

5. 空数据处理：
   - 如果数组为空，显示 `el-empty`，文案：`暂无行情数据`

### 4.2 TDD & 验收点

后续将为概览页新增以下前端测试/验收点（可以是手工 + E2E 测试规划）：

1. 页面打开 `/stocks/overview` 时：
   - [ ] 显示“市场行情一览”卡片
   - [ ] 表格展示至少 10 条 Mock 行情数据
2. 涨跌幅颜色：
   - [ ] 涨幅为正的行，`pct_chg` 文本为红色
   - [ ] 跌幅为负的行，`pct_chg` 文本为绿色
3. 点击行为：
   - [ ] 点击某一行的股票代码/名称，会跳转到 `/stocks/{code}` 详情页

> 注意：本轮不强制要求自动化单元测试代码，但所有交互必须能按上述步骤手动验证。

---

## 5. 数据集合详情页面需求（/stocks/collections/:collectionName）

### 5.1 页面结构

新建组件：`frontend/src/views/Stocks/Collection.vue`，整体结构参考 `Bonds/Collection.vue`：

1. 顶部信息区：
   - 显示当前数据集合的：
     - 显示名称（从路由或上一级传入）
     - 集合英文名（`collectionName`）
     - 描述（可以从 `/api/stocks/collections` 的数据中找到匹配项）
   - 提供一个“返回数据集合列表”按钮，返回 `/stocks/collections`

2. 字段说明区：
   - 使用 `el-card` + `el-table` 显示该集合的字段列表：
     - 列：字段名（name）、示例值（sample，暂可为空）、说明（description，暂可留空）
   - 当前版本可以直接根据集合名称使用本地定义的字段配置。

3. 数据表格区：
   - 下方使用 `el-table` 显示数据记录列表
   - 列与字段配置保持一致（至少 code + 若干核心字段）
   - 当前版本：允许使用 Mock 数据填充（后端数据接口待后续实现）

4. 分页与操作区：
   - 提供分页组件 `el-pagination`，每页 20 条
   - 右上角预留“刷新”按钮（目前只重新加载 Mock 数据）

### 5.2 数据来源（当前版本）

当前版本先不依赖后端真实集合数据接口，实现方式：

1. 在前端定义一个 `collectionDefinitions` 常量，用于描述每个集合：
   ```ts
   const collectionDefinitions = {
     stock_basic_info: {
       display_name: '股票基础信息',
       description: '股票的基础信息，包括代码、名称、行业、市场等',
       fields: ['code', 'name', 'industry', 'market', 'list_date', 'total_mv', 'circ_mv', 'pe', 'pb']
     },
     // ... 其他5个集合
   }
   ```

2. 在详情页根据 `collectionName` 选择对应定义：
   - 如果找不到对应集合，显示 `el-empty`，文案：`未找到对应的数据集合`

3. 数据记录 Mock：
   - 为每个集合定义一组示例数据（5~10条），以便表格有数据可看

### 5.3 路由与导航行为

1. 从“数据集合”列表页点击卡片跳转：
   - 原有的 `ElMessage.info("点击了集合: xxx")` 改为：
     ```ts
     router.push({
       name: 'StocksCollectionDetail',
       params: { collectionName }
     })
     ```

2. 在详情页顶部提供“返回数据集合列表”按钮：
   - 点击后 `router.push('/stocks/collections')`

### 5.4 TDD & 验收点

后续验收时需满足：

1. 从 `/stocks/collections` 点击任意一个集合：
   - [ ] 跳转到 `/stocks/collections/{collectionName}`
   - [ ] 页头正确显示集合名称与描述
2. 字段说明表：
   - [ ] 显示当前集合的字段列表
3. 数据表格：
   - [ ] 显示若干条 Mock 数据
   - [ ] 支持分页（即使是Mock，也能切换页码）
4. 回退行为：
   - [ ] 点击“返回数据集合列表”按钮，回到 `/stocks/collections`

---

## 6. 非功能性要求

1. **UI 风格一致性**：
   - 使用与 `Bonds` 模块相同的布局风格（卡片、表格、分页）
   - 颜色、阴影、间距尽可能复用现有样式

2. **性能**：
   - Mock数据为前端常量，不发起多余的网络请求

3. **可扩展性**：
   - 预留将来替换为真实后端API的接口位置：
     - 概览行情列表将来可以调用 `/api/stocks/quotes/overview`（待实现）
     - 集合详情页可以调用 `/api/stocks/collections/{name}/data`（待实现）

---

## 7. 开发与测试顺序（TDD 思路）

1. **需求与验收标准（当前文档）** ✅
2. **规划前端测试/验收用例**：
   - 手工验收步骤写入 `tests/stocks/快速验收-前端股票投研UI.md`
3. **实现概览页面增强**：
   - 新增行情列表模块
   - 验证页面布局与交互
4. **实现数据集合详情页面**：
   - 新建 `Collection.vue`
   - 完成路由与导航
5. **完整验收**：
   - 按文档中的“验收点”逐项手工检查

---

## 8. 验收结论（通过条件）

当满足以下条件时，本次前端任务视为通过：

1. 打开 `/stocks/overview`：
   - [ ] 能看到“市场行情一览”区块
   - [ ] 表格有至少 10 条行情记录
   - [ ] 涨跌幅颜色显示正确
   - [ ] 点击股票代码/名称能跳转到详情页

2. 打开 `/stocks/collections`：
   - [ ] 点击任意集合卡片能跳转到详情页

3. 在 `/stocks/collections/{collectionName}`：
   - [ ] 显示集合名称、描述
   - [ ] 显示字段列表
   - [ ] 显示数据表格（Mock数据）
   - [ ] 支持分页与刷新
   - [ ] “返回数据集合列表”按钮可用

4. 所有操作过程中：
   - [ ] 浏览器控制台无未处理错误（红色报错）

满足以上所有勾选项，即可判定“股票投研 / 概览 / 数据集合详情”前端实现 **验收通过**。
