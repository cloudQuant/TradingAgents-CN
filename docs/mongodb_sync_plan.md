# TradingAgents-CN æ•°æ®é›†åˆåŒæ­¥æ–¹æ¡ˆ

> ç›®æ ‡ï¼šè®¾è®¡ä¸€å¥—**åº”ç”¨å±‚çš„æ•°æ®é›†åˆåŒæ­¥ç³»ç»Ÿ**ï¼Œæ”¯æŒä»»æ„ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„é›†åˆçº§åˆ«æ¨é€/æ‹‰å–ï¼Œè¦†ç›–å±€åŸŸç½‘ã€æœåŠ¡å™¨-æœ¬åœ°ã€äº’è”ç½‘ç­‰å¤šç§ç½‘ç»œåœºæ™¯ã€‚å®ç°çš„æ—¶å€™éœ€è¦é›†æˆåˆ°æ•°æ®é›†åˆçš„è¿œç¨‹åŒæ­¥çš„ç•Œé¢ä¸­ï¼Œæ›´æ–°è¿™ä¸ªè¿œç¨‹åŒæ­¥çš„å¼¹å‡ºçš„å¯¹è¯æ¡†ï¼›å¦å¤–å°±æ˜¯ä¸€ä¸ªå•ç‹¬çš„ç•Œé¢ï¼Œç”¨äºç®¡ç†èŠ‚ç‚¹å’ŒåŒæ­¥ä»»åŠ¡ã€‚

---

## ä¸€ã€è®¾è®¡ç†å¿µ

### 1.1 æ ¸å¿ƒæ€æƒ³

**å»ä¸­å¿ƒåŒ– + é›†åˆç²’åº¦ + HTTP API ä¼ è¾“**

- **å»ä¸­å¿ƒåŒ–**ï¼šæ²¡æœ‰å›ºå®šçš„ä¸»ä»å…³ç³»ï¼Œä»»æ„èŠ‚ç‚¹éƒ½å¯ä»¥ä½œä¸ºæ•°æ®æºæˆ–ç›®æ ‡
- **é›†åˆç²’åº¦**ï¼šä»¥ MongoDB Collection ä¸ºåŒæ­¥å•ä½ï¼Œç²¾ç¡®æ§åˆ¶åŒæ­¥èŒƒå›´
- **HTTP API**ï¼šé€šè¿‡ REST API ä¼ è¾“æ•°æ®ï¼Œæ— éœ€ç›´æ¥æš´éœ² MongoDB ç«¯å£ï¼Œæ›´å®‰å…¨çµæ´»

### 1.2 ä¸ä¼ ç»Ÿæ–¹æ¡ˆå¯¹æ¯”

| ç‰¹æ€§ | ä¼ ç»Ÿæ–¹æ¡ˆ (Replica Set) | æœ¬æ–¹æ¡ˆ (åº”ç”¨å±‚åŒæ­¥) |
|------|----------------------|-------------------|
| åŒæ­¥ç²’åº¦ | æ•´åº“ | é›†åˆçº§åˆ« |
| ç½‘ç»œè¦æ±‚ | MongoDB ç«¯å£äº’é€š | HTTP ç«¯å£å³å¯ |
| æ–¹å‘æ§åˆ¶ | å•å‘ (Primaryâ†’Secondary) | åŒå‘ (Push/Pull) |
| èŠ‚ç‚¹å…³ç³» | å›ºå®šä¸»ä» | å¯¹ç­‰èŠ‚ç‚¹ |
| å®‰å…¨æ€§ | éœ€è¦æš´éœ² MongoDB | ä»…æš´éœ² HTTP API |
| éƒ¨ç½²å¤æ‚åº¦ | é«˜ (å‰¯æœ¬é›†é…ç½®) | ä½ (å¯åŠ¨ API æœåŠ¡å³å¯) |

---

## äºŒã€ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        èŠ‚ç‚¹ A (æœ¬åœ°)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  MongoDB    â”‚â—„â”€â”€â”€â”‚ Sync Serviceâ”‚â—„â”€â”€â”€â”‚  HTTP API   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚  (Local)    â”‚    â”‚             â”‚    â”‚  /sync/*    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚ HTTP (Push/Pull)
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        èŠ‚ç‚¹ B (æœåŠ¡å™¨)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  MongoDB    â”‚â—„â”€â”€â”€â”‚ Sync Serviceâ”‚â—„â”€â”€â”€â”‚  HTTP API   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚  (Remote)   â”‚    â”‚             â”‚    â”‚  /sync/*    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒç»„ä»¶

1. **SyncNodeï¼ˆåŒæ­¥èŠ‚ç‚¹ï¼‰**ï¼šä»£è¡¨ä¸€ä¸ªå¯åŒæ­¥çš„ç«¯ç‚¹ï¼ŒåŒ…å«åœ°å€ã€è®¤è¯ä¿¡æ¯
2. **SyncServiceï¼ˆåŒæ­¥æœåŠ¡ï¼‰**ï¼šæ‰§è¡Œå®é™…çš„æ¨é€/æ‹‰å–é€»è¾‘
3. **SyncAPIï¼ˆåŒæ­¥æ¥å£ï¼‰**ï¼šæä¾› HTTP ç«¯ç‚¹ä¾›è¿œç¨‹è°ƒç”¨
4. **SyncConfigï¼ˆåŒæ­¥é…ç½®ï¼‰**ï¼šç®¡ç†èŠ‚ç‚¹åˆ—è¡¨å’ŒåŒæ­¥ç­–ç•¥

---

## ä¸‰ã€æ•°æ®æ¨¡å‹

### 3.1 åŒæ­¥èŠ‚ç‚¹é…ç½®

```python
# å­˜å‚¨åœ¨ MongoDB: sync_nodes é›†åˆ
{
    "_id": ObjectId,
    "node_id": "server_main",           # èŠ‚ç‚¹å”¯ä¸€æ ‡è¯†
    "name": "ä¸»æœåŠ¡å™¨",                   # æ˜¾ç¤ºåç§°
    "url": "https://server.example.com", # èŠ‚ç‚¹ API åœ°å€
    "api_key": "encrypted_key",          # è®¤è¯å¯†é’¥ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰
    "description": "ç”Ÿäº§ç¯å¢ƒä¸»æœåŠ¡å™¨",
    "tags": ["production", "primary"],   # æ ‡ç­¾ï¼Œä¾¿äºåˆ†ç»„
    "status": "active",                  # active/inactive
    "last_sync_at": datetime,            # ä¸Šæ¬¡åŒæ­¥æ—¶é—´
    "created_at": datetime,
    "updated_at": datetime
}
```

### 3.2 åŒæ­¥ä»»åŠ¡è®°å½•

```python
# å­˜å‚¨åœ¨ MongoDB: sync_tasks é›†åˆ
{
    "_id": ObjectId,
    "task_id": "uuid",
    "direction": "push",                 # push/pull
    "source_node": "local",              # æºèŠ‚ç‚¹
    "target_node": "server_main",        # ç›®æ ‡èŠ‚ç‚¹
    "collection": "stock_daily_kline",   # åŒæ­¥çš„é›†åˆ
    "filter": {"trade_date": {"$gte": "2024-01-01"}},  # å¯é€‰è¿‡æ»¤æ¡ä»¶
    "status": "completed",               # pending/running/completed/failed
    "stats": {
        "total_records": 10000,
        "transferred": 10000,
        "inserted": 5000,
        "updated": 5000,
        "failed": 0
    },
    "started_at": datetime,
    "completed_at": datetime,
    "error_message": null
}
```

### 3.3 é›†åˆå…ƒæ•°æ®

```python
# å­˜å‚¨åœ¨ MongoDB: sync_collection_meta é›†åˆ
{
    "_id": ObjectId,
    "collection": "stock_daily_kline",
    "unique_keys": ["ts_code", "trade_date"],  # ç”¨äº upsert çš„å”¯ä¸€é”®
    "sync_strategy": "incremental",            # full/incremental
    "incremental_field": "trade_date",         # å¢é‡åŒæ­¥å­—æ®µ
    "chunk_size": 5000,                        # æ¯æ‰¹ä¼ è¾“æ•°é‡
    "description": "è‚¡ç¥¨æ—¥çº¿è¡Œæƒ…"
}
```

---

## å››ã€API è®¾è®¡

### 4.1 èŠ‚ç‚¹ç®¡ç† API

```yaml
# èŠ‚ç‚¹åˆ—è¡¨
GET /api/sync/nodes
Response: { nodes: [...], total: N }

# æ·»åŠ èŠ‚ç‚¹
POST /api/sync/nodes
Body: { node_id, name, url, api_key, description, tags }

# æµ‹è¯•èŠ‚ç‚¹è¿æ¥
POST /api/sync/nodes/{node_id}/test
Response: { success: true, latency_ms: 50, version: "1.0.0" }

# åˆ é™¤èŠ‚ç‚¹
DELETE /api/sync/nodes/{node_id}
```

### 4.2 åŒæ­¥æ“ä½œ API

```yaml
# æ‹‰å–æ•°æ® (ä»è¿œç¨‹èŠ‚ç‚¹è·å–æ•°æ®åˆ°æœ¬åœ°)
POST /api/sync/pull
Body: {
    "source_node": "server_main",
    "collection": "stock_daily_kline",
    "filter": {"trade_date": {"$gte": "2024-01-01"}},  # å¯é€‰
    "strategy": "incremental"  # full/incremental
}
Response: { task_id: "uuid", status: "started" }

# æ¨é€æ•°æ® (å°†æœ¬åœ°æ•°æ®å‘é€åˆ°è¿œç¨‹èŠ‚ç‚¹)
POST /api/sync/push
Body: {
    "target_node": "server_main",
    "collection": "stock_daily_kline",
    "filter": {"trade_date": {"$gte": "2024-01-01"}},  # å¯é€‰
    "strategy": "incremental"
}
Response: { task_id: "uuid", status: "started" }

# æŸ¥è¯¢åŒæ­¥ä»»åŠ¡çŠ¶æ€
GET /api/sync/tasks/{task_id}
Response: { task_id, status, stats, ... }

# å–æ¶ˆåŒæ­¥ä»»åŠ¡
POST /api/sync/tasks/{task_id}/cancel
```

### 4.3 æ•°æ®ä¼ è¾“ APIï¼ˆèŠ‚ç‚¹é—´è°ƒç”¨ï¼‰

```yaml
# è·å–é›†åˆæ•°æ®ï¼ˆä¾›è¿œç¨‹èŠ‚ç‚¹æ‹‰å–ï¼‰
POST /api/sync/data/export
Headers: { X-Sync-API-Key: "api_key" }
Body: {
    "collection": "stock_daily_kline",
    "filter": {...},
    "skip": 0,
    "limit": 5000
}
Response: {
    "data": [...],           # æ•°æ®æ•°ç»„
    "total": 100000,         # æ€»è®°å½•æ•°
    "has_more": true,        # æ˜¯å¦è¿˜æœ‰æ›´å¤š
    "checksum": "md5hash"    # æ•°æ®æ ¡éªŒ
}

# æ¥æ”¶é›†åˆæ•°æ®ï¼ˆä¾›è¿œç¨‹èŠ‚ç‚¹æ¨é€ï¼‰
POST /api/sync/data/import
Headers: { X-Sync-API-Key: "api_key" }
Body: {
    "collection": "stock_daily_kline",
    "data": [...],
    "unique_keys": ["ts_code", "trade_date"],
    "mode": "upsert"  # upsert/insert/replace
}
Response: { inserted: N, updated: M, failed: K }

# è·å–é›†åˆç»Ÿè®¡ä¿¡æ¯
POST /api/sync/data/stats
Headers: { X-Sync-API-Key: "api_key" }
Body: { "collection": "stock_daily_kline" }
Response: {
    "count": 100000,
    "latest_date": "2024-12-01",
    "oldest_date": "2020-01-01"
}
```

---

## äº”ã€åŒæ­¥ç­–ç•¥

### 5.1 å…¨é‡åŒæ­¥ (Full Sync)

é€‚ç”¨åœºæ™¯ï¼šé¦–æ¬¡åŒæ­¥ã€æ•°æ®é‡å»º

```
1. æ¸…ç©ºç›®æ ‡é›†åˆï¼ˆå¯é€‰ï¼‰
2. åˆ†æ‰¹è¯»å–æºé›†åˆå…¨éƒ¨æ•°æ®
3. æ‰¹é‡ upsert åˆ°ç›®æ ‡é›†åˆ
4. éªŒè¯æ•°æ®ä¸€è‡´æ€§
```

### 5.2 å¢é‡åŒæ­¥ (Incremental Sync)

é€‚ç”¨åœºæ™¯ï¼šæ—¥å¸¸æ›´æ–°

```
1. è·å–ç›®æ ‡é›†åˆçš„æœ€æ–°æ—¶é—´æˆ³
2. ä»æºé›†åˆè¯»å–è¯¥æ—¶é—´æˆ³ä¹‹åçš„æ•°æ®
3. æ‰¹é‡ upsert åˆ°ç›®æ ‡é›†åˆ
```

### 5.3 å·®å¼‚åŒæ­¥ (Diff Sync)

é€‚ç”¨åœºæ™¯ï¼šä¸ç¡®å®šå“ªè¾¹æ›´æ–°

```
1. å¯¹æ¯”æºå’Œç›®æ ‡çš„è®°å½•æ•°é‡ã€æœ€æ–°æ—¶é—´
2. è®¡ç®—å·®å¼‚è®°å½•
3. åŒå‘ä¼ è¾“å·®å¼‚æ•°æ®
```

### 5.4 å†²çªå¤„ç†ç­–ç•¥

```python
conflict_strategies = {
    "source_wins": "æºæ•°æ®è¦†ç›–ç›®æ ‡",
    "target_wins": "ä¿ç•™ç›®æ ‡æ•°æ®",
    "newer_wins": "æ ¹æ® updated_at å­—æ®µå†³å®š",
    "manual": "è®°å½•å†²çªï¼Œäººå·¥å¤„ç†"
}
```

---

## å…­ã€å®‰å…¨è®¾è®¡

### 6.1 è®¤è¯æœºåˆ¶

```python
# API Key è®¤è¯
# æ¯ä¸ªèŠ‚ç‚¹é…ç½®å”¯ä¸€çš„ API Key
# è¯·æ±‚æ—¶é€šè¿‡ Header ä¼ é€’: X-Sync-API-Key

# å¯é€‰: JWT Token è®¤è¯
# æ”¯æŒæ›´ç»†ç²’åº¦çš„æƒé™æ§åˆ¶
```

### 6.2 ä¼ è¾“å®‰å…¨

- **HTTPS**ï¼šç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ HTTPS
- **æ•°æ®å‹ç¼©**ï¼šå¤§æ‰¹é‡æ•°æ®ä¼ è¾“æ—¶ä½¿ç”¨ gzip å‹ç¼©
- **æ ¡éªŒå’Œ**ï¼šæ¯æ‰¹æ•°æ®é™„å¸¦ checksum éªŒè¯å®Œæ•´æ€§

### 6.3 æƒé™æ§åˆ¶

```python
# èŠ‚ç‚¹æƒé™é…ç½®
{
    "node_id": "readonly_node",
    "permissions": {
        "export": ["stock_*", "fund_*"],  # å…è®¸å¯¼å‡ºçš„é›†åˆ
        "import": []                       # ä¸å…è®¸å¯¼å…¥
    }
}
```

---

## ä¸ƒã€ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### 7.1 æœåŠ¡å™¨ â†’ æœ¬åœ°ï¼ˆPullï¼‰

```bash
# åœºæ™¯ï¼šä»æœåŠ¡å™¨æ‹‰å–æœ€æ–°çš„è‚¡ç¥¨æ—¥çº¿æ•°æ®åˆ°æœ¬åœ°

POST /api/sync/pull
{
    "source_node": "production_server",
    "collection": "stock_daily_kline",
    "strategy": "incremental"
}

# ç³»ç»Ÿè‡ªåŠ¨ï¼š
# 1. æŸ¥è¯¢æœ¬åœ°æœ€æ–°æ—¥æœŸ: 2024-11-30
# 2. ä»æœåŠ¡å™¨æ‹‰å– 2024-12-01 ä¹‹åçš„æ•°æ®
# 3. Upsert åˆ°æœ¬åœ° MongoDB
```

### 7.2 æœ¬åœ° â†’ æœåŠ¡å™¨ï¼ˆPushï¼‰

```bash
# åœºæ™¯ï¼šå°†æœ¬åœ°æ•´ç†å¥½çš„åŸºé‡‘æ•°æ®æ¨é€åˆ°æœåŠ¡å™¨

POST /api/sync/push
{
    "target_node": "production_server",
    "collection": "fund_basic_info",
    "strategy": "full"
}
```

### 7.3 å¤šèŠ‚ç‚¹åŒæ­¥

```bash
# åœºæ™¯ï¼šå°†æœåŠ¡å™¨ A çš„æ•°æ®åŒæ­¥åˆ°æœåŠ¡å™¨ B å’Œæœ¬åœ°

# Step 1: æœ¬åœ°ä»æœåŠ¡å™¨ A æ‹‰å–
POST /api/sync/pull
{ "source_node": "server_a", "collection": "stock_info" }

# Step 2: æœ¬åœ°æ¨é€åˆ°æœåŠ¡å™¨ B
POST /api/sync/push
{ "target_node": "server_b", "collection": "stock_info" }
```

### 7.4 äº’è”ç½‘åŒæ­¥ï¼ˆNAT ç©¿é€åœºæ™¯ï¼‰

```bash
# åœºæ™¯ï¼šå®¶é‡Œçš„ç”µè„‘æ— å…¬ç½‘ IPï¼Œä½†æƒ³å’Œäº‘æœåŠ¡å™¨åŒæ­¥

# æ–¹æ¡ˆ 1: é€šè¿‡äº‘æœåŠ¡å™¨ä¸­è½¬
# - æœ¬åœ°ä¸»åŠ¨è¿æ¥äº‘æœåŠ¡å™¨
# - ä½¿ç”¨ Push ä¸Šä¼ æ•°æ®
# - ä½¿ç”¨ Pull ä¸‹è½½æ•°æ®

# æ–¹æ¡ˆ 2: ä½¿ç”¨ FRP/Ngrok ç­‰å†…ç½‘ç©¿é€å·¥å…·
# - å°†æœ¬åœ° API æœåŠ¡æš´éœ²åˆ°å…¬ç½‘
# - äº‘æœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨è¿æ¥æœ¬åœ°
```

---

## å…«ã€å‰ç«¯ç•Œé¢è®¾è®¡

### 8.1 èŠ‚ç‚¹ç®¡ç†é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŒæ­¥èŠ‚ç‚¹ç®¡ç†                                    [+ æ·»åŠ èŠ‚ç‚¹] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸŸ¢ ä¸»æœåŠ¡å™¨ (server_main)                               â”‚ â”‚
â”‚ â”‚    URL: https://api.example.com                         â”‚ â”‚
â”‚ â”‚    ä¸Šæ¬¡åŒæ­¥: 2024-12-01 10:30:00                        â”‚ â”‚
â”‚ â”‚    [æµ‹è¯•è¿æ¥] [ç¼–è¾‘] [åˆ é™¤]                              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸŸ¡ å¤‡ä»½æœåŠ¡å™¨ (server_backup)                           â”‚ â”‚
â”‚ â”‚    URL: https://backup.example.com                      â”‚ â”‚
â”‚ â”‚    çŠ¶æ€: è¿æ¥è¶…æ—¶                                        â”‚ â”‚
â”‚ â”‚    [æµ‹è¯•è¿æ¥] [ç¼–è¾‘] [åˆ é™¤]                              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 åŒæ­¥æ“ä½œé¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®åŒæ­¥                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é€‰æ‹©é›†åˆ: [stock_daily_kline        â–¼]                     â”‚
â”‚                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚ â”‚ ğŸ“¥ ä»è¿œç¨‹æ‹‰å– (Pull) â”‚    â”‚ ğŸ“¤ æ¨é€åˆ°è¿œç¨‹ (Push) â”‚         â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
â”‚ â”‚ æºèŠ‚ç‚¹:             â”‚    â”‚ ç›®æ ‡èŠ‚ç‚¹:            â”‚         â”‚
â”‚ â”‚ [ä¸»æœåŠ¡å™¨      â–¼]   â”‚    â”‚ [ä¸»æœåŠ¡å™¨      â–¼]   â”‚         â”‚
â”‚ â”‚                     â”‚    â”‚                     â”‚         â”‚
â”‚ â”‚ åŒæ­¥ç­–ç•¥:           â”‚    â”‚ åŒæ­¥ç­–ç•¥:           â”‚         â”‚
â”‚ â”‚ â—‹ å…¨é‡åŒæ­¥          â”‚    â”‚ â—‹ å…¨é‡åŒæ­¥          â”‚         â”‚
â”‚ â”‚ â— å¢é‡åŒæ­¥          â”‚    â”‚ â— å¢é‡åŒæ­¥          â”‚         â”‚
â”‚ â”‚                     â”‚    â”‚                     â”‚         â”‚
â”‚ â”‚ [å¼€å§‹æ‹‰å–]          â”‚    â”‚ [å¼€å§‹æ¨é€]          â”‚         â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                             â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åŒæ­¥è¿›åº¦ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚
â”‚ ä»»åŠ¡ID: abc123                                              â”‚
â”‚ çŠ¶æ€: è¿›è¡Œä¸­                                                â”‚
â”‚ è¿›åº¦: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 50% (5000/10000)                  â”‚
â”‚ å·²æ’å…¥: 3000 | å·²æ›´æ–°: 2000 | å¤±è´¥: 0                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.3 åŒæ­¥å†å²é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŒæ­¥å†å²                                      [å¯¼å‡ºè®°å½•]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ—¶é—´             æ–¹å‘   é›†åˆ              èŠ‚ç‚¹       çŠ¶æ€   â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ 12-01 10:30:00   Pull   stock_daily_kline ä¸»æœåŠ¡å™¨   âœ…     â”‚
â”‚ 12-01 09:00:00   Push   fund_basic_info   å¤‡ä»½æœåŠ¡å™¨ âœ…     â”‚
â”‚ 11-30 18:00:00   Pull   bond_info         ä¸»æœåŠ¡å™¨   âŒ     â”‚
â”‚ ...                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¹ã€å®ç°è·¯çº¿å›¾

### Phase 1: åŸºç¡€æ¡†æ¶ï¼ˆ1-2 å¤©ï¼‰

- [ ] å®šä¹‰æ•°æ®æ¨¡å‹ï¼ˆSyncNode, SyncTask, CollectionMetaï¼‰
- [ ] å®ç° SyncService åŸºç¡€ç±»
- [ ] å®ç°èŠ‚ç‚¹ç®¡ç† API
- [ ] å®ç°èŠ‚ç‚¹è¿æ¥æµ‹è¯•

### Phase 2: æ ¸å¿ƒåŒæ­¥åŠŸèƒ½ï¼ˆ2-3 å¤©ï¼‰

- [ ] å®ç°æ•°æ®å¯¼å‡º APIï¼ˆexportï¼‰
- [ ] å®ç°æ•°æ®å¯¼å…¥ APIï¼ˆimportï¼‰
- [ ] å®ç° Pull åŒæ­¥æµç¨‹
- [ ] å®ç° Push åŒæ­¥æµç¨‹
- [ ] å®ç°å¢é‡åŒæ­¥é€»è¾‘

### Phase 3: å‰ç«¯ç•Œé¢ï¼ˆ2 å¤©ï¼‰

- [ ] èŠ‚ç‚¹ç®¡ç†é¡µé¢
- [ ] åŒæ­¥æ“ä½œé¡µé¢
- [ ] åŒæ­¥å†å²é¡µé¢
- [ ] å®æ—¶è¿›åº¦å±•ç¤º

### Phase 4: å¢å¼ºåŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

- [ ] æ‰¹é‡åŒæ­¥å¤šä¸ªé›†åˆ
- [ ] å®šæ—¶åŒæ­¥ä»»åŠ¡
- [ ] åŒæ­¥æ¨¡æ¿ï¼ˆé¢„è®¾å¸¸ç”¨åŒæ­¥é…ç½®ï¼‰
- [ ] æ•°æ®å‹ç¼©ä¼ è¾“
- [ ] æ–­ç‚¹ç»­ä¼ 

---

## åã€é…ç½®ç¤ºä¾‹

### 10.1 ç¯å¢ƒå˜é‡

```bash
# .env
SYNC_API_KEY=your_secret_api_key_here
SYNC_ENABLED=true
SYNC_MAX_CHUNK_SIZE=5000
SYNC_TIMEOUT_SECONDS=300
```

### 10.2 é›†åˆåŒæ­¥é…ç½®

```python
# åœ¨ä»£ç ä¸­å®šä¹‰å„é›†åˆçš„åŒæ­¥å…ƒæ•°æ®
SYNC_COLLECTION_CONFIG = {
    "stock_daily_kline": {
        "unique_keys": ["ts_code", "trade_date"],
        "incremental_field": "trade_date",
        "chunk_size": 5000
    },
    "fund_basic_info": {
        "unique_keys": ["fund_code"],
        "incremental_field": None,  # å…¨é‡åŒæ­¥
        "chunk_size": 1000
    },
    "stock_info": {
        "unique_keys": ["ts_code"],
        "incremental_field": "list_date",
        "chunk_size": 2000
    }
}
```

---

## åä¸€ã€ä¸ç°æœ‰ç³»ç»Ÿé›†æˆ

æœ¬æ–¹æ¡ˆä¸ç°æœ‰çš„ Collection ç®¡ç†ç³»ç»Ÿå®Œå…¨å…¼å®¹ï¼š

1. **å…±äº«æ•°æ®æ¨¡å‹**ï¼šä½¿ç”¨ç›¸åŒçš„ MongoDB é›†åˆ
2. **å…±äº«å”¯ä¸€é”®é…ç½®**ï¼šå¤ç”¨ç°æœ‰çš„ `unique_keys` å®šä¹‰
3. **UI é›†æˆ**ï¼šåœ¨ç°æœ‰ Collection é¡µé¢æ·»åŠ "åŒæ­¥"æ ‡ç­¾é¡µ
4. **æƒé™å¤ç”¨**ï¼šå¤ç”¨ç°æœ‰çš„è®¤è¯ç³»ç»Ÿ

```vue
<!-- Collection.vue ä¸­æ·»åŠ åŒæ­¥æ ‡ç­¾ -->
<el-tabs>
  <el-tab-pane label="æ•°æ®ç®¡ç†">...</el-tab-pane>
  <el-tab-pane label="æ•°æ®åŒæ­¥">
    <SyncPanel :collection="currentCollection" />
  </el-tab-pane>
</el-tabs>
